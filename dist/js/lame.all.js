//zhuker https://github.com/zhuker/lamejs
//build:2015/12/30 08:57:04
function lamejs(){function e(e){return new Int8Array(e)}function a(e){return new Int16Array(e)}function t(e){return new Int32Array(e)}function s(e){return new Float32Array(e)}function r(e){return new Float64Array(e)}function n(e){if(1==e.length)return s(e[0]);var a=e[0];e=e.slice(1);for(var t=[],r=0;a>r;r++)t.push(n(e));return t}function _(e){if(1==e.length)return t(e[0]);var a=e[0];e=e.slice(1);for(var s=[],r=0;a>r;r++)s.push(_(e));return s}function i(e){if(1==e.length)return a(e[0]);var t=e[0];e=e.slice(1);for(var s=[],r=0;t>r;r++)s.push(i(e));return s}function o(e){if(1==e.length)return new Array(e[0]);var a=e[0];e=e.slice(1);for(var t=[],s=0;a>s;s++)t.push(o(e));return t}function l(e){this.ordinal=e}function f(e){this.ordinal=e}function c(e){var a=e;this.ordinal=function(){return a}}function h(){var e="http://www.mp3dev.org/",a=3,t=98,s=4,r=0,n=93;this.getLameVersion=function(){return a+"."+t+"."+s},this.getLameShortVersion=function(){return a+"."+t+"."+s},this.getLameVeryShortVersion=function(){return"LAME"+a+"."+t+"r"},this.getPsyVersion=function(){return r+"."+n},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}function u(){function e(e,a,t,s,r,n,_,i,o,l,f,c,h,u,b){this.vbr_q=e,this.quant_comp=a,this.quant_comp_s=t,this.expY=s,this.st_lrm=r,this.st_s=n,this.masking_adj=_,this.masking_adj_short=i,this.ath_lower=o,this.ath_curve=l,this.ath_sensitivity=f,this.interch=c,this.safejoint=h,this.sfb21mod=u,this.msfix=b}function a(e,a,t,s,r,n,_,i,o,l,f,c,h,u){this.quant_comp=a,this.quant_comp_s=t,this.safejoint=s,this.nsmsfix=r,this.st_lrm=n,this.st_s=_,this.nsbass=i,this.scale=o,this.masking_adj=l,this.ath_lower=f,this.ath_curve=c,this.interch=h,this.sfscale=u}function t(e,a,t){var s=e.VBR==f.vbr_rh?_:i,n=e.VBR_q_frac,o=s[a],l=s[a+1],c=o;o.st_lrm=o.st_lrm+n*(l.st_lrm-o.st_lrm),o.st_s=o.st_s+n*(l.st_s-o.st_s),o.masking_adj=o.masking_adj+n*(l.masking_adj-o.masking_adj),o.masking_adj_short=o.masking_adj_short+n*(l.masking_adj_short-o.masking_adj_short),o.ath_lower=o.ath_lower+n*(l.ath_lower-o.ath_lower),o.ath_curve=o.ath_curve+n*(l.ath_curve-o.ath_curve),o.ath_sensitivity=o.ath_sensitivity+n*(l.ath_sensitivity-o.ath_sensitivity),o.interch=o.interch+n*(l.interch-o.interch),o.msfix=o.msfix+n*(l.msfix-o.msfix),r(e,c.vbr_q),0!=t?e.quant_comp=c.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=c.quant_comp),0!=t?e.quant_comp_short=c.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=c.quant_comp_s),0!=c.expY&&(e.experimentalY=0!=c.expY),0!=t?e.internal_flags.nsPsy.attackthre=c.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=c.st_lrm),0!=t?e.internal_flags.nsPsy.attackthre_s=c.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=c.st_s),0!=t?e.maskingadjust=c.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=c.masking_adj),0!=t?e.maskingadjust_short=c.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=c.masking_adj_short),0!=t?e.ATHlower=-c.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-c.ath_lower/10),0!=t?e.ATHcurve=c.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=c.ath_curve),0!=t?e.athaa_sensitivity=c.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(0!=t?e.interChRatio=c.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=c.interch)),c.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|c.sfb21mod<<20),0!=t?e.msfix=c.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=c.msfix),0==t&&(e.VBR_q=a,e.VBR_q_frac=n)}function s(e,a,t){var s=a,r=n.nearestBitrateFullIndex(a);if(e.VBR=f.vbr_abr,e.VBR_mean_bitrate_kbps=s,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[r].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[r].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[r].nsbass)>0){var _=int(4*o[r].nsbass);0>_&&(_+=64),e.exp_nspsytune=e.exp_nspsytune|_<<2}return 0!=t?e.quant_comp=o[r].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[r].quant_comp),0!=t?e.quant_comp_short=o[r].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[r].quant_comp_s),0!=t?e.msfix=o[r].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[r].nsmsfix),0!=t?e.internal_flags.nsPsy.attackthre=o[r].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[r].st_lrm),0!=t?e.internal_flags.nsPsy.attackthre_s=o[r].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[r].st_s),0!=t?e.scale=o[r].scale:Math.abs(e.scale- -1)>0||(e.scale=o[r].scale),0!=t?e.maskingadjust=o[r].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[r].masking_adj),o[r].masking_adj>0?0!=t?e.maskingadjust_short=.9*o[r].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[r].masking_adj):0!=t?e.maskingadjust_short=1.1*o[r].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[r].masking_adj),0!=t?e.ATHlower=-o[r].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[r].ath_lower/10),0!=t?e.ATHcurve=o[r].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[r].ath_curve),0!=t?e.interChRatio=o[r].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[r].interch),a}function r(e,a){var t=0;return 0>a&&(t=-1,a=0),a>9&&(t=-1,a=9),e.VBR_q=a,e.VBR_q_frac=0,t}var n;this.setModules=function(e){n=e};var _=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],i=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],o=[new a(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new a(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new a(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new a(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new a(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new a(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new a(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new a(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new a(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new a(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new a(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new a(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new a(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new a(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new a(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,a,r){switch(a){case C.R3MIX:a=C.V3,e.VBR=f.vbr_mtrh;break;case C.MEDIUM:a=C.V4,e.VBR=f.vbr_rh;break;case C.MEDIUM_FAST:a=C.V4,e.VBR=f.vbr_mtrh;break;case C.STANDARD:a=C.V2,e.VBR=f.vbr_rh;break;case C.STANDARD_FAST:a=C.V2,e.VBR=f.vbr_mtrh;break;case C.EXTREME:a=C.V0,e.VBR=f.vbr_rh;break;case C.EXTREME_FAST:a=C.V0,e.VBR=f.vbr_mtrh;break;case C.INSANE:return a=320,e.preset=a,s(e,a,r),e.VBR=f.vbr_off,a}switch(e.preset=a,a){case C.V9:return t(e,9,r),a;case C.V8:return t(e,8,r),a;case C.V7:return t(e,7,r),a;case C.V6:return t(e,6,r),a;case C.V5:return t(e,5,r),a;case C.V4:return t(e,4,r),a;case C.V3:return t(e,3,r),a;case C.V2:return t(e,2,r),a;case C.V1:return t(e,1,r),a;case C.V0:return t(e,0,r),a}return a>=8&&320>=a?s(e,a,r):(e.preset=0,a)}}function b(){function e(e,a,t,s,r,n){for(;0!=r--;)t[s]=1e-10+e[a+0]*n[0]-t[s-1]*n[1]+e[a-1]*n[2]-t[s-2]*n[3]+e[a-2]*n[4]-t[s-3]*n[5]+e[a-3]*n[6]-t[s-4]*n[7]+e[a-4]*n[8]-t[s-5]*n[9]+e[a-5]*n[10]-t[s-6]*n[11]+e[a-6]*n[12]-t[s-7]*n[13]+e[a-7]*n[14]-t[s-8]*n[15]+e[a-8]*n[16]-t[s-9]*n[17]+e[a-9]*n[18]-t[s-10]*n[19]+e[a-10]*n[20],++s,++a}function a(e,a,t,s,r,n){for(;0!=r--;)t[s]=e[a+0]*n[0]-t[s-1]*n[1]+e[a-1]*n[2]-t[s-2]*n[3]+e[a-2]*n[4],++s,++a}function t(e,a){for(var t=0;t<MAX_ORDER;t++)e.linprebuf[t]=e.lstepbuf[t]=e.loutbuf[t]=e.rinprebuf[t]=e.rstepbuf[t]=e.routbuf[t]=0;switch(0|a){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return e.sampleWindow=0|(a*i+o-1)/o,e.lsum=0,e.rsum=0,e.totsamp=0,U.ill(e.A,0),INIT_GAIN_ANALYSIS_OK}function s(e){return e*e}function r(e,a){var t,s=0;for(t=0;a>t;t++)s+=e[t];if(0==s)return GAIN_NOT_ENOUGH_SAMPLES;var r=0|Math.ceil(s*(1-_));for(t=a;t-->0&&!((r-=e[t])<=0););return n-t/b.STEPS_per_dB}var n=64.82,_=(b.YULE_ORDER,.95),i=(b.MAX_SAMP_FREQ,b.RMS_WINDOW_TIME_NUMERATOR),o=b.RMS_WINDOW_TIME_DENOMINATOR,l=(b.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),f=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];this.InitGainAnalysis=function(e,a){return t(e,a)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,U.fill(e.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(t,r,n,_,i,o,c){var h,u,m,p,v,d,g;if(0==o)return GAIN_ANALYSIS_OK;switch(g=0,v=o,c){case 1:_=r,i=n;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(o<MAX_ORDER?(W.arraycopy(r,n,t.linprebuf,MAX_ORDER,o),W.arraycopy(_,i,t.rinprebuf,MAX_ORDER,o)):(W.arraycopy(r,n,t.linprebuf,MAX_ORDER,MAX_ORDER),W.arraycopy(_,i,t.rinprebuf,MAX_ORDER,MAX_ORDER));v>0;){d=v>t.sampleWindow-t.totsamp?t.sampleWindow-t.totsamp:v,g<MAX_ORDER?(h=t.linpre+g,u=t.linprebuf,m=t.rinpre+g,p=t.rinprebuf,d>MAX_ORDER-g&&(d=MAX_ORDER-g)):(h=n+g,u=r,m=i+g,p=_),e(u,h,t.lstepbuf,t.lstep+t.totsamp,d,l[t.reqindex]),e(p,m,t.rstepbuf,t.rstep+t.totsamp,d,l[t.reqindex]),a(t.lstepbuf,t.lstep+t.totsamp,t.loutbuf,t.lout+t.totsamp,d,f[t.reqindex]),a(t.rstepbuf,t.rstep+t.totsamp,t.routbuf,t.rout+t.totsamp,d,f[t.reqindex]),h=t.lout+t.totsamp,u=t.loutbuf,m=t.rout+t.totsamp,p=t.routbuf;for(var S=d%8;0!=S--;)t.lsum+=s(u[h++]),t.rsum+=s(p[m++]);for(S=d/8;0!=S--;)t.lsum+=s(u[h+0])+s(u[h+1])+s(u[h+2])+s(u[h+3])+s(u[h+4])+s(u[h+5])+s(u[h+6])+s(u[h+7]),h+=8,t.rsum+=s(p[m+0])+s(p[m+1])+s(p[m+2])+s(p[m+3])+s(p[m+4])+s(p[m+5])+s(p[m+6])+s(p[m+7]),m+=8;if(v-=d,g+=d,t.totsamp+=d,t.totsamp==t.sampleWindow){var R=10*b.STEPS_per_dB*Math.log10((t.lsum+t.rsum)/t.totsamp*.5+1e-37),M=0>=R?0:0|R;M>=t.A.length&&(M=t.A.length-1),t.A[M]++,t.lsum=t.rsum=0,W.arraycopy(t.loutbuf,t.totsamp,t.loutbuf,0,MAX_ORDER),W.arraycopy(t.routbuf,t.totsamp,t.routbuf,0,MAX_ORDER),W.arraycopy(t.lstepbuf,t.totsamp,t.lstepbuf,0,MAX_ORDER),W.arraycopy(t.rstepbuf,t.totsamp,t.rstepbuf,0,MAX_ORDER),t.totsamp=0}if(t.totsamp>t.sampleWindow)return GAIN_ANALYSIS_ERROR}return o<MAX_ORDER?(W.arraycopy(t.linprebuf,o,t.linprebuf,0,MAX_ORDER-o),W.arraycopy(t.rinprebuf,o,t.rinprebuf,0,MAX_ORDER-o),W.arraycopy(r,n,t.linprebuf,MAX_ORDER-o,o),W.arraycopy(_,i,t.rinprebuf,MAX_ORDER-o,o)):(W.arraycopy(r,n+o-MAX_ORDER,t.linprebuf,0,MAX_ORDER),W.arraycopy(_,i+o-MAX_ORDER,t.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var a=r(e.A,e.A.length),t=0;t<e.A.length;t++)e.B[t]+=e.A[t],e.A[t]=0;for(var t=0;t<MAX_ORDER;t++)e.linprebuf[t]=e.lstepbuf[t]=e.loutbuf[t]=e.rinprebuf[t]=e.rstepbuf[t]=e.routbuf[t]=0;return e.totsamp=0,e.lsum=e.rsum=0,a}}function m(){function e(e){this.bits=0|e}function a(e,a,t,s,r,n){var _=.5946/a;for(e>>=1;0!=e--;)r[n++]=_>t[s++]?0:1,r[n++]=_>t[s++]?0:1}function s(e,a,t,s,r,n){e>>=1;var _=e%2;for(e>>=1;0!=e--;){var i,o,l,f,c,h,u,m;i=t[s++]*a,o=t[s++]*a,c=0|i,l=t[s++]*a,h=0|o,f=t[s++]*a,u=0|l,i+=b.adj43[c],m=0|f,o+=b.adj43[h],r[n++]=0|i,l+=b.adj43[u],r[n++]=0|o,f+=b.adj43[m],r[n++]=0|l,r[n++]=0|f}if(0!=_){var i,o,c,h;i=t[s++]*a,o=t[s++]*a,c=0|i,h=0|o,i+=b.adj43[c],o+=b.adj43[h],r[n++]=0|i,r[n++]=0|o}}function r(e,t,r,n,_){var i,o,l,f=0,c=0,h=0,u=0,m=t,p=0,v=m,d=0,g=e,S=0;for(l=null!=_&&n.global_gain==_.global_gain,o=n.block_type==V.SHORT_TYPE?38:21,i=0;o>=i;i++){var R=-1;if((l||n.block_type==V.NORM_TYPE)&&(R=n.global_gain-(n.scalefac[i]+(0!=n.preflag?b.pretab[i]:0)<<n.scalefac_scale+1)-8*n.subblock_gain[n.window[i]]),l&&_.step[i]==R)0!=c&&(s(c,r,g,S,v,d),c=0),0!=h&&(a(h,r,g,S,v,d),h=0);else{var M=n.width[i];if(f+n.width[i]>n.max_nonzero_coeff){var A;A=n.max_nonzero_coeff-f+1,U.fill(t,n.max_nonzero_coeff,576,0),M=A,0>M&&(M=0),i=o+1}if(0==c&&0==h&&(v=m,d=p,g=e,S=u),null!=_&&_.sfb_count1>0&&i>=_.sfb_count1&&_.step[i]>0&&R>=_.step[i]?(0!=c&&(s(c,r,g,S,v,d),c=0,v=m,d=p,g=e,S=u),h+=M):(0!=h&&(a(h,r,g,S,v,d),h=0,v=m,d=p,g=e,S=u),c+=M),0>=M){0!=h&&(a(h,r,g,S,v,d),h=0),0!=c&&(s(c,r,g,S,v,d),c=0);break}}o>=i&&(p+=n.width[i],u+=n.width[i],f+=n.width[i])}0!=c&&(s(c,r,g,S,v,d),c=0),0!=h&&(a(h,r,g,S,v,d),h=0)}function n(e,a,t){var s=0,r=0;do{var n=e[a++],_=e[a++];n>s&&(s=n),_>r&&(r=_)}while(t>a);return r>s&&(s=r),s}function _(e,a,t,s,r,n){var _,i=65536*ee.ht[s].xlen+ee.ht[r].xlen,o=0;do{var l=e[a++],f=e[a++];0!=l&&(l>14&&(l=15,o+=i),l*=16),0!=f&&(f>14&&(f=15,o+=i),l+=f),o+=ee.largetbl[l]}while(t>a);return _=65535&o,o>>=16,o>_&&(o=_,s=r),n.bits+=o,s}function i(e,a,t,s){var r=0,n=ee.ht[1].hlen;do{var _=2*e[a+0]+e[a+1];a+=2,r+=n[_]}while(t>a);return s.bits+=r,1}function o(e,a,t,s,r){var n,_,i=0,o=ee.ht[s].xlen;_=2==s?ee.table23:ee.table56;do{var l=e[a+0]*o+e[a+1];a+=2,i+=_[l]}while(t>a);return n=65535&i,i>>=16,i>n&&(i=n,s++),r.bits+=i,s}function l(e,a,t,s,r){var n=0,_=0,i=0,o=ee.ht[s].xlen,l=ee.ht[s].hlen,f=ee.ht[s+1].hlen,c=ee.ht[s+2].hlen;do{var h=e[a+0]*o+e[a+1];a+=2,n+=l[h],_+=f[h],i+=c[h]}while(t>a);var u=s;return n>_&&(n=_,u++),n>i&&(n=i,u=s+2),r.bits+=n,u}function f(e,a,t,s){var r=n(e,a,t);switch(r){case 0:return r;case 1:return i(e,a,t,s);case 2:case 3:return o(e,a,t,v[r-1],s);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return l(e,a,t,v[r-1],s);default:if(r>k.IXMAX_VAL)return s.bits=k.LARGE_BITS,-1;r-=15;var f;for(f=24;32>f&&!(ee.ht[f].linmax>=r);f++);var c;for(c=f-8;24>c&&!(ee.ht[c].linmax>=r);c++);return _(e,a,t,c,f,s)}}function c(a,t,s,r,n,_,i){for(var o=t.big_values,l=0;22>=l;l++)r[l]=k.LARGE_BITS;for(var l=0;16>l;l++){var c=a.scalefac_band.l[l+1];if(c>=o)break;var h=0,u=new e(h),b=f(s,0,c,u);h=u.bits;for(var m=0;8>m;m++){var p=a.scalefac_band.l[l+m+2];if(p>=o)break;var v=h;u=new e(v);var d=f(s,c,p,u);v=u.bits,r[l+m]>v&&(r[l+m]=v,n[l+m]=l,_[l+m]=b,i[l+m]=d)}}}function h(a,t,s,r,n,_,i,o){for(var l=t.big_values,c=2;c<V.SBMAX_l+1;c++){var h=a.scalefac_band.l[c];if(h>=l)break;var u=n[c-2]+t.count1bits;if(s.part2_3_length<=u)break;var b=new e(u),m=f(r,h,l,b);u=b.bits,s.part2_3_length<=u||(s.assign(t),s.part2_3_length=u,s.region0_count=_[c-2],s.region1_count=c-2-_[c-2],s.table_select[0]=i[c-2],s.table_select[1]=o[c-2],s.table_select[2]=m)}}function u(e,a){for(var t,s=a.tt[1][e],r=a.tt[0][e],n=0;n<ee.scfsi_band.length-1;n++){for(t=ee.scfsi_band[n];t<ee.scfsi_band[n+1]&&!(r.scalefac[t]!=s.scalefac[t]&&s.scalefac[t]>=0);t++);if(t==ee.scfsi_band[n+1]){for(t=ee.scfsi_band[n];t<ee.scfsi_band[n+1];t++)s.scalefac[t]=-1;a.scfsi[e][n]=1}}var _=0,i=0;for(t=0;11>t;t++)-1!=s.scalefac[t]&&(i++,_<s.scalefac[t]&&(_=s.scalefac[t]));for(var o=0,l=0;t<V.SBPSY_l;t++)-1!=s.scalefac[t]&&(l++,o<s.scalefac[t]&&(o=s.scalefac[t]));for(var n=0;16>n;n++)if(_<d[n]&&o<g[n]){var f=S[n]*i+R[n]*l;s.part2_length>f&&(s.part2_length=f,s.scalefac_compress=n)}}var b=null;this.qupvt=null,this.setModules=function(e){this.qupvt=e,b=e};var p=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],v=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(a,t,s){var r=t.l3_enc,n=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=s&&(s.sfb_count1=0);n>1&&0==(r[n-1]|r[n-2]);n-=2);t.count1=n;for(var _=0,i=0;n>3;n-=4){var o;if((2147483647&(r[n-1]|r[n-2]|r[n-3]|r[n-4]))>1)break;o=2*(2*(2*r[n-4]+r[n-3])+r[n-2])+r[n-1],_+=ee.t32l[o],i+=ee.t33l[o]}var l=_;if(t.count1table_select=0,_>i&&(l=i,t.count1table_select=1),t.count1bits=l,t.big_values=n,0==n)return l;if(t.block_type==V.SHORT_TYPE)_=3*a.scalefac_band.s[3],_>t.big_values&&(_=t.big_values),i=t.big_values;else if(t.block_type==V.NORM_TYPE){if(_=t.region0_count=a.bv_scf[n-2],i=t.region1_count=a.bv_scf[n-1],i=a.scalefac_band.l[_+i+2],_=a.scalefac_band.l[_+1],n>i){var c=new e(l);t.table_select[2]=f(r,i,n,c),l=c.bits}}else t.region0_count=7,t.region1_count=V.SBMAX_l-1-7-1,_=a.scalefac_band.l[8],i=n,_>i&&(_=i);if(_=Math.min(_,n),i=Math.min(i,n),_>0){var c=new e(l);t.table_select[0]=f(r,0,_,c),l=c.bits}if(i>_){var c=new e(l);t.table_select[1]=f(r,_,i,c),l=c.bits}if(2==a.use_best_huffman&&(t.part2_3_length=l,best_huffman_divide(a,t),l=t.part2_3_length),null!=s&&t.block_type==V.NORM_TYPE){for(var h=0;a.scalefac_band.l[h]<t.big_values;)h++;s.sfb_count1=h}return l},this.count_bits=function(e,a,t,s){var n=t.l3_enc,_=k.IXMAX_VAL/b.IPOW20(t.global_gain);if(t.xrpow_max>_)return k.LARGE_BITS;if(r(a,n,b.IPOW20(t.global_gain),t,s),0!=(2&e.substep_shaping))for(var i=0,o=t.global_gain+t.scalefac_scale,l=.634521682242439/b.IPOW20(o),f=0;f<t.sfbmax;f++){var c=t.width[f];if(0==e.pseudohalf[f])i+=c;else{var h;for(h=i,i+=c;i>h;++h)n[h]=a[h]>=l?n[h]:0}}return this.noquant_count_bits(e,t,s)},this.best_huffman_divide=function(a,s){var r=new y,n=s.l3_enc,_=t(23),i=t(23),o=t(23),l=t(23);if(s.block_type!=V.SHORT_TYPE||1!=a.mode_gr){r.assign(s),s.block_type==V.NORM_TYPE&&(c(a,s,n,_,i,o,l),h(a,r,s,n,_,i,o,l));var u=r.big_values;if(!(0==u||(n[u-2]|n[u-1])>1||(u=s.count1+2,u>576))){r.assign(s),r.count1=u;for(var b=0,m=0;u>r.big_values;u-=4){var p=2*(2*(2*n[u-4]+n[u-3])+n[u-2])+n[u-1];b+=ee.t32l[p],m+=ee.t33l[p]}if(r.big_values=u,r.count1table_select=0,b>m&&(b=m,r.count1table_select=1),r.count1bits=b,r.block_type==V.NORM_TYPE)h(a,r,s,n,_,i,o,l);else{if(r.part2_3_length=b,b=a.scalefac_band.l[8],b>u&&(b=u),b>0){var v=new e(r.part2_3_length);r.table_select[0]=f(n,0,b,v),r.part2_3_length=v.bits}if(u>b){var v=new e(r.part2_3_length);r.table_select[1]=f(n,b,u,v),r.part2_3_length=v.bits}s.part2_3_length>r.part2_3_length&&s.assign(r)}}}};var d=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],S=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],R=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];m.slen1_tab=S,m.slen2_tab=R,this.best_scalefac_store=function(e,a,t,s){var r,n,_,i,o=s.tt[a][t],l=0;for(_=0,r=0;r<o.sfbmax;r++){var f=o.width[r];for(_+=f,i=-f;0>i&&0==o.l3_enc[i+_];i++);0==i&&(o.scalefac[r]=l=-2)}if(0==o.scalefac_scale&&0==o.preflag){var c=0;for(r=0;r<o.sfbmax;r++)o.scalefac[r]>0&&(c|=o.scalefac[r]);if(0==(1&c)&&0!=c){for(r=0;r<o.sfbmax;r++)o.scalefac[r]>0&&(o.scalefac[r]>>=1);o.scalefac_scale=l=1}}if(0==o.preflag&&o.block_type!=V.SHORT_TYPE&&2==e.mode_gr){for(r=11;r<V.SBPSY_l&&!(o.scalefac[r]<b.pretab[r]&&-2!=o.scalefac[r]);r++);if(r==V.SBPSY_l){for(r=11;r<V.SBPSY_l;r++)o.scalefac[r]>0&&(o.scalefac[r]-=b.pretab[r]);o.preflag=l=1}}for(n=0;4>n;n++)s.scfsi[t][n]=0;for(2==e.mode_gr&&1==a&&s.tt[0][t].block_type!=V.SHORT_TYPE&&s.tt[1][t].block_type!=V.SHORT_TYPE&&(u(t,s),l=0),r=0;r<o.sfbmax;r++)-2==o.scalefac[r]&&(o.scalefac[r]=0);0!=l&&(2==e.mode_gr?this.scale_bitcount(o):this.scale_bitcount_lsf(e,o))};var M=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],A=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],B=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var a,t,s,r=0,n=0,_=e.scalefac;if(e.block_type==V.SHORT_TYPE)s=M,0!=e.mixed_block_flag&&(s=A);else if(s=B,0==e.preflag){for(t=11;t<V.SBPSY_l&&!(_[t]<b.pretab[t]);t++);if(t==V.SBPSY_l)for(e.preflag=1,t=11;t<V.SBPSY_l;t++)_[t]-=b.pretab[t]}for(t=0;t<e.sfbdivide;t++)r<_[t]&&(r=_[t]);for(;t<e.sfbmax;t++)n<_[t]&&(n=_[t]);for(e.part2_length=k.LARGE_BITS,a=0;16>a;a++)r<d[a]&&n<g[a]&&e.part2_length>s[a]&&(e.part2_length=s[a],e.scalefac_compress=a);return e.part2_length==k.LARGE_BITS};var w=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,a){var s,r,n,_,i,o,l,f,c=t(4),h=a.scalefac;for(s=0!=a.preflag?2:0,l=0;4>l;l++)c[l]=0;if(a.block_type==V.SHORT_TYPE){r=1;var u=b.nr_of_sfb_block[s][r];for(f=0,n=0;4>n;n++)for(_=u[n]/3,l=0;_>l;l++,f++)for(i=0;3>i;i++)h[3*f+i]>c[n]&&(c[n]=h[3*f+i])}else{r=0;var u=b.nr_of_sfb_block[s][r];for(f=0,n=0;4>n;n++)for(_=u[n],l=0;_>l;l++,f++)h[f]>c[n]&&(c[n]=h[f])}for(o=!1,n=0;4>n;n++)c[n]>w[s][n]&&(o=!0);if(!o){var m,p,v,d;for(a.sfb_partition_table=b.nr_of_sfb_block[s][r],n=0;4>n;n++)a.slen[n]=T[c[n]];switch(m=a.slen[0],p=a.slen[1],v=a.slen[2],d=a.slen[3],s){case 0:a.scalefac_compress=(5*m+p<<4)+(v<<2)+d;break;case 1:a.scalefac_compress=400+(5*m+p<<2)+v;break;case 2:a.scalefac_compress=500+3*m+p;break;default:W.err.printf("intensity stereo not implemented yet\n")}}if(!o)for(a.part2_length=0,n=0;4>n;n++)a.part2_length+=a.slen[n]*a.sfb_partition_table[n];return o};var T=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var a=2;576>=a;a+=2){for(var t,s=0;e.scalefac_band.l[++s]<a;);for(t=p[s][0];e.scalefac_band.l[t+1]>a;)t--;for(0>t&&(t=p[s][0]),e.bv_scf[a-2]=t,t=p[s][1];e.scalefac_band.l[t+e.bv_scf[a-2]+2]>a;)t--;0>t&&(t=p[s][1]),e.bv_scf[a-1]=t}}}function p(){var e;this.setModules=function(a){e=a},this.ResvFrameBegin=function(a,t){var s,r=a.internal_flags,n=r.l3_side,_=e.getframebits(a);t.bits=(_-8*r.sideinfo_len)/r.mode_gr;var i=2048*r.mode_gr-8;a.brate>320?s=8*int(1e3*a.brate/(a.out_samplerate/1152)/8+.5):(s=11520,a.strict_ISO&&(s=8*int(32e4/(a.out_samplerate/1152)/8+.5))),r.ResvMax=s-_,r.ResvMax>i&&(r.ResvMax=i),(r.ResvMax<0||a.disable_reservoir)&&(r.ResvMax=0);var o=t.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return o>s&&(o=s),n.resvDrain_pre=0,null!=r.pinfo&&(r.pinfo.mean_bits=t.bits/2,r.pinfo.resvsize=r.ResvSize),o},this.ResvMaxBits=function(e,a,t,s){var r,n=e.internal_flags,_=n.ResvSize,i=n.ResvMax;0!=s&&(_+=a),0!=(1&n.substep_shaping)&&(i*=.9),t.bits=a,10*_>9*i?(r=_-9*i/10,t.bits+=r,n.substep_shaping|=128):(r=0,n.substep_shaping&=127,e.disable_reservoir||0!=(1&n.substep_shaping)||(t.bits-=.1*a));var o=_<6*n.ResvMax/10?_:6*n.ResvMax/10;return o-=r,0>o&&(o=0),o},this.ResvAdjust=function(e,a){e.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(e,a){var t,s=e.l3_side;e.ResvSize+=a*e.mode_gr;var r=0;s.resvDrain_post=0,s.resvDrain_pre=0,0!=(t=e.ResvSize%8)&&(r+=t),t=e.ResvSize-r-e.ResvMax,t>0&&(r+=t);var n=Math.min(8*s.main_data_begin,r)/8;s.resvDrain_pre+=8*n,r-=8*n,e.ResvSize-=8*n,s.main_data_begin-=n,s.resvDrain_post+=r,e.ResvSize-=r}}function v(){function a(e){W.arraycopy(e.header[e.w_ptr].buf,0,w,E,e.sideinfo_len),E+=e.sideinfo_len,T+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&X.MAX_HEADER_BUF-1}function s(e,t,s){for(;s>0;){var r;0==k&&(k=8,E++,e.header[e.w_ptr].write_timing==T&&a(e),w[E]=0),r=Math.min(s,k),s-=r,k-=r,w[E]|=t>>s<<k,T+=r}}function r(e,a,t){for(;t>0;){var s;0==k&&(k=8,E++,w[E]=0),s=Math.min(t,k),t-=s,k-=s,w[E]|=a>>t<<k,T+=s}}function _(e,a){var t,r=e.internal_flags;if(a>=8&&(s(r,76,8),a-=8),a>=8&&(s(r,65,8),a-=8),a>=8&&(s(r,77,8),a-=8),a>=8&&(s(r,69,8),a-=8),a>=32){var n=A.getLameShortVersion();if(a>=32)for(t=0;t<n.length&&a>=8;++t)a-=8,s(r,n.charAt(t),8)}for(;a>=1;a-=1)s(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1}function i(e,a,t){for(var s=e.header[e.h_ptr].ptr;t>0;){var r=Math.min(t,8-(7&s));t-=r,e.header[e.h_ptr].buf[s>>3]|=a>>t<<8-(7&s)-r,s+=r}e.header[e.h_ptr].ptr=s}function o(e,a){e<<=8;for(var t=0;8>t;t++)e<<=1,a<<=1,0!=(65536&(a^e))&&(a^=S);return a}function l(e,a){var t,s,r,n=e.internal_flags;if(t=n.l3_side,n.header[n.h_ptr].ptr=0,U.fill(n.header[n.h_ptr].buf,0,n.sideinfo_len,0),e.out_samplerate<16e3?i(n,4094,12):i(n,4095,12),i(n,e.version,1),i(n,1,2),i(n,e.error_protection?0:1,1),i(n,n.bitrate_index,4),i(n,n.samplerate_index,2),i(n,n.padding,1),i(n,e.extension,1),i(n,e.mode.ordinal(),2),i(n,n.mode_ext,2),i(n,e.copyright,1),i(n,e.original,1),i(n,e.emphasis,2),e.error_protection&&i(n,0,16),1==e.version){for(i(n,t.main_data_begin,9),2==n.channels_out?i(n,t.private_bits,3):i(n,t.private_bits,5),r=0;r<n.channels_out;r++){var _;for(_=0;4>_;_++)i(n,t.scfsi[r][_],1)}for(s=0;2>s;s++)for(r=0;r<n.channels_out;r++){var o=t.tt[s][r];i(n,o.part2_3_length+o.part2_length,12),i(n,o.big_values/2,9),i(n,o.global_gain,8),i(n,o.scalefac_compress,4),o.block_type!=V.NORM_TYPE?(i(n,1,1),i(n,o.block_type,2),i(n,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),i(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),i(n,o.table_select[1],5),i(n,o.subblock_gain[0],3),i(n,o.subblock_gain[1],3),i(n,o.subblock_gain[2],3)):(i(n,0,1),14==o.table_select[0]&&(o.table_select[0]=16),i(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),i(n,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),i(n,o.table_select[2],5),i(n,o.region0_count,4),i(n,o.region1_count,3)),i(n,o.preflag,1),i(n,o.scalefac_scale,1),i(n,o.count1table_select,1)}}else for(i(n,t.main_data_begin,8),i(n,t.private_bits,n.channels_out),s=0,r=0;r<n.channels_out;r++){var o=t.tt[s][r];i(n,o.part2_3_length+o.part2_length,12),i(n,o.big_values/2,9),i(n,o.global_gain,8),i(n,o.scalefac_compress,9),o.block_type!=V.NORM_TYPE?(i(n,1,1),i(n,o.block_type,2),i(n,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),i(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),i(n,o.table_select[1],5),i(n,o.subblock_gain[0],3),i(n,o.subblock_gain[1],3),i(n,o.subblock_gain[2],3)):(i(n,0,1),14==o.table_select[0]&&(o.table_select[0]=16),i(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),i(n,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),i(n,o.table_select[2],5),i(n,o.region0_count,4),i(n,o.region1_count,3)),i(n,o.scalefac_scale,1),i(n,o.count1table_select,1)}e.error_protection&&CRC_writeheader(n,n.header[n.h_ptr].buf);var l=n.h_ptr;n.h_ptr=l+1&X.MAX_HEADER_BUF-1,n.header[n.h_ptr].write_timing=n.header[l].write_timing+a,n.h_ptr==n.w_ptr&&W.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}function f(e,a){var t,r=ee.ht[a.count1table_select+32],n=0,_=a.big_values,i=a.big_values;for(t=(a.count1-a.big_values)/4;t>0;--t){var o,l=0,f=0;o=a.l3_enc[_+0],0!=o&&(f+=8,a.xr[i+0]<0&&l++),o=a.l3_enc[_+1],0!=o&&(f+=4,l*=2,a.xr[i+1]<0&&l++),o=a.l3_enc[_+2],0!=o&&(f+=2,l*=2,a.xr[i+2]<0&&l++),o=a.l3_enc[_+3],0!=o&&(f++,l*=2,a.xr[i+3]<0&&l++),_+=4,i+=4,s(e,l+r.table[f],r.hlen[f]),n+=r.hlen[f]}return n}function c(e,a,t,r,n){var _=ee.ht[a],i=0;if(0==a)return i;for(var o=t;r>o;o+=2){var l=0,f=0,c=_.xlen,h=_.xlen,u=0,b=n.l3_enc[o],m=n.l3_enc[o+1];if(0!=b&&(n.xr[o]<0&&u++,l--),a>15){if(b>14){var p=b-15;u|=p<<1,f=c,b=15}if(m>14){var v=m-15;u<<=c,u|=v,f+=c,m=15}h=16}0!=m&&(u<<=1,n.xr[o+1]<0&&u++,l--),b=b*h+m,f-=l,l+=_.hlen[b],s(e,_.table[b],l),s(e,u,f),i+=l+f}return i}function h(e,a){var t=3*e.scalefac_band.s[3];t>a.big_values&&(t=a.big_values);var s=c(e,a.table_select[0],0,t,a);return s+=c(e,a.table_select[1],t,a.big_values,a)}function u(e,a){var t,s,r,n;t=a.big_values;var _=a.region0_count+1;return r=e.scalefac_band.l[_],_+=a.region1_count+1,n=e.scalefac_band.l[_],r>t&&(r=t),n>t&&(n=t),s=c(e,a.table_select[0],0,r,a),s+=c(e,a.table_select[1],r,n,a),s+=c(e,a.table_select[2],n,t,a)}function p(e){var a,t,r,n,_=0,i=e.internal_flags,o=i.l3_side;if(1==e.version)for(a=0;2>a;a++)for(t=0;t<i.channels_out;t++){
var l=o.tt[a][t],c=m.slen1_tab[l.scalefac_compress],b=m.slen2_tab[l.scalefac_compress];for(n=0,r=0;r<l.sfbdivide;r++)-1!=l.scalefac[r]&&(s(i,l.scalefac[r],c),n+=c);for(;r<l.sfbmax;r++)-1!=l.scalefac[r]&&(s(i,l.scalefac[r],b),n+=b);n+=l.block_type==V.SHORT_TYPE?h(i,l):u(i,l),n+=f(i,l),_+=n}else for(a=0,t=0;t<i.channels_out;t++){var p,v,l=o.tt[a][t],d=0;if(n=0,r=0,v=0,l.block_type==V.SHORT_TYPE){for(;4>v;v++){var g=l.sfb_partition_table[v]/3,S=l.slen[v];for(p=0;g>p;p++,r++)s(i,Math.max(l.scalefac[3*r+0],0),S),s(i,Math.max(l.scalefac[3*r+1],0),S),s(i,Math.max(l.scalefac[3*r+2],0),S),d+=3*S}n+=h(i,l)}else{for(;4>v;v++){var g=l.sfb_partition_table[v],S=l.slen[v];for(p=0;g>p;p++,r++)s(i,Math.max(l.scalefac[r],0),S),d+=S}n+=u(i,l)}n+=f(i,l),_+=d+n}return _}function v(){this.total=0}function d(e,a){var t,s,r,n,_,i=e.internal_flags;return _=i.w_ptr,n=i.h_ptr-1,-1==n&&(n=X.MAX_HEADER_BUF-1),t=i.header[n].write_timing-T,a.total=t,t>=0&&(s=1+n-_,_>n&&(s=1+n-_+X.MAX_HEADER_BUF),t-=8*s*i.sideinfo_len),r=g.getframebits(e),t+=r,a.total+=r,a.total%8!=0?a.total=1+a.total/8:a.total=a.total/8,a.total+=E+1,0>t&&W.err.println("strange error flushing buffer ... \n"),t}var g=this,S=32773,R=null,M=null,A=null,B=null;this.setModules=function(e,a,t,s){R=e,M=a,A=t,B=s};var w=null,T=0,E=0,k=0;this.getframebits=function(e){var a,t=e.internal_flags;a=0!=t.bitrate_index?ee.bitrate_table[e.version][t.bitrate_index]:e.brate;var s=0|72e3*(e.version+1)*a/e.out_samplerate+t.padding;return 8*s},this.CRC_writeheader=function(e,a){var t=65535;t=o(255&a[2],t),t=o(255&a[3],t);for(var s=6;s<e.sideinfo_len;s++)t=o(255&a[s],t);a[4]=byte(t>>8),a[5]=byte(255&t)},this.flush_bitstream=function(e){var a,t,s=e.internal_flags,r=s.h_ptr-1;if(-1==r&&(r=X.MAX_HEADER_BUF-1),a=s.l3_side,!((t=d(e,new v))<0)){if(_(e,t),s.ResvSize=0,a.main_data_begin=0,s.findReplayGain){var n=R.GetTitleGain(s.rgdata);s.RadioGain=0|Math.floor(10*n+.5)}s.findPeakSample&&(s.noclipGainChange=0|Math.ceil(20*Math.log10(s.PeakSample/32767)*10),s.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?s.noclipScale=Math.floor(32767/s.PeakSample*100)/100:s.noclipScale=-1)}},this.add_dummy_byte=function(e,a,t){for(var s,n=e.internal_flags;t-->0;)for(r(n,a,8),s=0;s<X.MAX_HEADER_BUF;++s)n.header[s].write_timing+=8},this.format_bitstream=function(e){var a,t=e.internal_flags;a=t.l3_side;var s=this.getframebits(e);_(e,a.resvDrain_pre),l(e,s);var r=8*t.sideinfo_len;if(r+=p(e),_(e,a.resvDrain_post),r+=a.resvDrain_post,a.main_data_begin+=(s-r)/8,d(e,new v)!=t.ResvSize&&W.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*a.main_data_begin!=t.ResvSize&&(W.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*a.main_data_begin,t.ResvSize,a.resvDrain_post,a.resvDrain_pre,8*t.sideinfo_len,r-a.resvDrain_post-8*t.sideinfo_len,r,r%8,s),W.err.println("This is a fatal error.  It has several possible causes:"),W.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),W.err.println(" 9%%  Your system is overclocked"),W.err.println(" 1%%  bug in LAME encoding library"),t.ResvSize=8*a.main_data_begin),T>1e9){var n;for(n=0;n<X.MAX_HEADER_BUF;++n)t.header[n].write_timing-=T;T=0}return 0},this.copy_buffer=function(e,a,s,r,_){var i=E+1;if(0>=i)return 0;if(0!=r&&i>r)return-1;if(W.arraycopy(w,0,a,s,i),E=-1,k=0,0!=_){var o=t(1);if(o[0]=e.nMusicCRC,B.updateMusicCRC(o,a,s,i),e.nMusicCRC=o[0],i>0&&(e.VBR_seek_table.nBytesWritten+=i),e.decode_on_the_fly)for(var l,f=n([2,1152]),c=i,h=-1;0!=h;)if(h=M.hip_decode1_unclipped(e.hip,a,s,c,f[0],f[1]),c=0,-1==h&&(h=0),h>0){if(e.findPeakSample){for(l=0;h>l;l++)f[0][l]>e.PeakSample?e.PeakSample=f[0][l]:-f[0][l]>e.PeakSample&&(e.PeakSample=-f[0][l]);if(e.channels_out>1)for(l=0;h>l;l++)f[1][l]>e.PeakSample?e.PeakSample=f[1][l]:-f[1][l]>e.PeakSample&&(e.PeakSample=-f[1][l])}if(e.findReplayGain&&R.AnalyzeSamples(e.rgdata,f[0],0,f[1],0,h,e.channels_out)==b.GAIN_ANALYSIS_ERROR)return-6}}return i},this.init_bit_stream_w=function(a){w=e(C.LAME_MAXMP3BUFFER),a.h_ptr=a.w_ptr=0,a.header[a.h_ptr].write_timing=0,E=-1,k=0,T=0}}function d(){function a(e,a){if(e.nVbrNumFrames++,e.sum+=a,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var t=1;t<e.size;t+=2)e.bag[t/2]=e.bag[t];e.want*=2,e.pos/=2}}function t(e,a){if(!(e.pos<=0))for(var t=1;M>t;++t){var s,r,n=t/M,_=0|Math.floor(n*e.pos);_>e.pos-1&&(_=e.pos-1),s=e.bag[_],r=e.sum;var i=0|256*s/r;i>255&&(i=255),a[t]=255&i}}function s(e,a){var t=255&e[a+0];return t<<=8,t|=255&e[a+1],t<<=8,t|=255&e[a+2],t<<=8,t|=255&e[a+3]}function r(e,a,t){e[a+0]=255&(t>>24&255),e[a+1]=255&(t>>16&255),e[a+2]=255&(t>>8&255),e[a+3]=255&(255&t)}function n(e,a,t){e[a+0]=255&(t>>8&255),e[a+1]=255&(255&t)}function _(e,a){return new String(e,a,y.length(),x).equals(y)||new String(e,a,P.length(),x).equals(P)}function i(e,a,t){return 255&(e<<a|t&~(-1<<a))}function o(e,a){var t=e.internal_flags;a[0]=i(a[0],8,255),a[1]=i(a[1],3,7),a[1]=i(a[1],1,e.out_samplerate<16e3?0:1),a[1]=i(a[1],1,e.version),a[1]=i(a[1],2,1),a[1]=i(a[1],1,e.error_protection?0:1),a[2]=i(a[2],4,t.bitrate_index),a[2]=i(a[2],2,t.samplerate_index),a[2]=i(a[2],1,0),a[2]=i(a[2],1,e.extension),a[3]=i(a[3],2,e.mode.ordinal()),a[3]=i(a[3],2,t.mode_ext),a[3]=i(a[3],1,e.copyright),a[3]=i(a[3],1,e.original),a[3]=i(a[3],2,e.emphasis),a[0]=255;var s,r=255&(241&a[1]);s=1==e.version?T:e.out_samplerate<16e3?k:E,e.VBR==f.vbr_off&&(s=e.brate);var n;n=e.free_format?0:255&16*b.BitrateIndex(s,e.version,e.out_samplerate),1==e.version?(a[1]=255&(10|r),r=255&(13&a[2]),a[2]=255&(n|r)):(a[1]=255&(2|r),r=255&(13&a[2]),a[2]=255&(n|r))}function c(e,a){var t=a^e;return a=a>>8^I[255&t]}function h(e,a,t,s,_){var i,o,f,h=e.internal_flags,u=0,b=e.encoder_delay,m=e.encoder_padding,v=100-10*e.VBR_q-e.quality,d=p.getLameVeryShortVersion(),g=0,S=[1,5,3,2,4,0,3],R=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),M=0,A=0,B=0,w=e.internal_flags.noise_shaping,T=0,E=0,k=0,x=0,y=0,P=0!=(1&e.exp_nspsytune),I=0!=(2&e.exp_nspsytune),H=!1,V=!1,O=e.internal_flags.nogap_total,L=e.internal_flags.nogap_current,N=e.ATHtype,D=0;switch(e.VBR){case vbr_abr:f=e.VBR_mean_bitrate_kbps;break;case vbr_off:f=e.brate;break;default:f=e.VBR_min_bitrate_kbps}switch(i=e.VBR.ordinal()<S.length?S[e.VBR.ordinal()]:0,o=16*g+i,h.findReplayGain&&(h.RadioGain>510&&(h.RadioGain=510),h.RadioGain<-510&&(h.RadioGain=-510),A=8192,A|=3072,h.RadioGain>=0?A|=h.RadioGain:(A|=512,A|=-h.RadioGain)),h.findPeakSample&&(M=Math.abs(0|h.PeakSample/32767*Math.pow(2,23)+.5)),-1!=O&&(L>0&&(V=!0),O-1>L&&(H=!0)),D=N+((P?1:0)<<4)+((I?1:0)<<5)+((H?1:0)<<6)+((V?1:0)<<7),0>v&&(v=0),e.mode){case MONO:T=0;break;case STEREO:T=1;break;case DUAL_CHANNEL:T=2;break;case JOINT_STEREO:T=e.force_ms?4:3;break;case NOT_SET:default:T=7}k=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==l.short_block_forced||e.short_blocks==l.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==N||e.in_samplerate<=32e3)&&(E=1),x=w+(T<<2)+(E<<5)+(k<<6),y=h.nMusicCRC,r(t,s+u,v),u+=4;for(var X=0;9>X;X++)t[s+u+X]=255&d.charAt(X);u+=9,t[s+u]=255&o,u++,t[s+u]=255&R,u++,r(t,s+u,M),u+=4,n(t,s+u,A),u+=2,n(t,s+u,B),u+=2,t[s+u]=255&D,u++,f>=255?t[s+u]=255:t[s+u]=255&f,u++,t[s+u]=255&b>>4,t[s+u+1]=255&(b<<4)+(m>>8),t[s+u+2]=255&m,u+=3,t[s+u]=255&x,u++,t[s+u++]=0,n(t,s+u,e.preset),u+=2,r(t,s+u,a),u+=4,n(t,s+u,y),u+=2;for(var Y=0;u>Y;Y++)_=c(t[s+Y],_);return n(t,s+u,_),u+=2}function u(a){a.seek(0);var t=e(10);a.readFully(t);var s;return s=new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}var b,m,p;this.setModules=function(e,a,t){b=e,m=a,p=t};var v=1,g=2,S=4,R=8,M=d.NUMTOCENTRIES,A=d.MAXFRAMESIZE,B=M+4+4+4+4+4,w=B+9+1+1+8+1+1+3+1+1+2+4+2+2,T=128,E=64,k=32,x=null,y="Xing",P="Info",I=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.addVbrFrame=function(e){var t=e.internal_flags,s=ee.bitrate_table[e.version][t.bitrate_index];a(t.VBR_seek_table,s)},this.getVbrTag=function(e){var a=new VBRTagData,t=0;a.flags=0;var r=e[t+1]>>3&1,n=e[t+2]>>2&3,i=e[t+3]>>6&3,o=e[t+2]>>4&15;if(o=ee.bitrate_table[r][o],e[t+1]>>4==14?a.samprate=ee.samplerate_table[2][n]:a.samprate=ee.samplerate_table[r][n],t+=0!=r?3!=i?36:21:3!=i?21:13,!_(e,t))return null;t+=4,a.hId=r;var l=a.flags=s(e,t);if(t+=4,0!=(l&v)&&(a.frames=s(e,t),t+=4),0!=(l&g)&&(a.bytes=s(e,t),t+=4),0!=(l&S)){if(null!=a.toc)for(var f=0;M>f;f++)a.toc[f]=e[t+f];t+=M}a.vbrScale=-1,0!=(l&R)&&(a.vbrScale=s(e,t),t+=4),a.headersize=72e3*(r+1)*o/a.samprate,t+=21;var c=e[t+0]<<4;c+=e[t+1]>>4;var h=(15&e[t+1])<<8;return h+=255&e[t+2],(0>c||c>3e3)&&(c=-1),(0>h||h>3e3)&&(h=-1),a.encDelay=c,a.encPadding=h,a},this.InitVbrTag=function(a){var t,s=a.internal_flags;t=1==a.version?T:a.out_samplerate<16e3?k:E,a.VBR==f.vbr_off&&(t=a.brate);var r=72e3*(a.version+1)*t/a.out_samplerate,n=s.sideinfo_len+w;if(s.VBR_seek_table.TotalFrameSize=r,n>r||r>A)return void(a.bWriteVbrTag=!1);s.VBR_seek_table.nVbrNumFrames=0,s.VBR_seek_table.nBytesWritten=0,s.VBR_seek_table.sum=0,s.VBR_seek_table.seen=0,s.VBR_seek_table.want=1,s.VBR_seek_table.pos=0,null==s.VBR_seek_table.bag&&(s.VBR_seek_table.bag=new int[400],s.VBR_seek_table.size=400);var _=e(A);o(a,_);for(var i=s.VBR_seek_table.TotalFrameSize,l=0;i>l;++l)m.add_dummy_byte(a,255&_[l],1)},this.updateMusicCRC=function(e,a,t,s){for(var r=0;s>r;++r)e[0]=c(a[t+r],e[0])},this.getLameTagFrame=function(a,s){var n=a.internal_flags;if(!a.bWriteVbrTag)return 0;if(n.Class_ID!=C.LAME_ID)return 0;if(n.VBR_seek_table.pos<=0)return 0;if(s.length<n.VBR_seek_table.TotalFrameSize)return n.VBR_seek_table.TotalFrameSize;U.fill(s,0,n.VBR_seek_table.TotalFrameSize,0),o(a,s);var _=e(M);if(a.free_format)for(var i=1;M>i;++i)_[i]=255&255*i/100;else t(n.VBR_seek_table,_);var l=n.sideinfo_len;a.error_protection&&(l-=2),a.VBR==f.vbr_off?(s[l++]=255&P.charAt(0),s[l++]=255&P.charAt(1),s[l++]=255&P.charAt(2),s[l++]=255&P.charAt(3)):(s[l++]=255&y.charAt(0),s[l++]=255&y.charAt(1),s[l++]=255&y.charAt(2),s[l++]=255&y.charAt(3)),r(s,l,v+g+S+R),l+=4,r(s,l,n.VBR_seek_table.nVbrNumFrames),l+=4;var u=n.VBR_seek_table.nBytesWritten+n.VBR_seek_table.TotalFrameSize;r(s,l,0|u),l+=4,W.arraycopy(_,0,s,l,_.length),l+=_.length,a.error_protection&&m.CRC_writeheader(n,s);for(var b=0,i=0;l>i;i++)b=c(s[i],b);return l+=h(a,u,s,l,b),n.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(a,t){var s=a.internal_flags;if(s.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var r=u(t);t.seek(r);var n=e(A),_=getLameTagFrame(a,n);return _>n.length?-1:1>_?0:(t.write(n,0,_),0)}}function g(e,a,t,s){this.xlen=e,this.linmax=a,this.table=t,this.hlen=s}function S(e){this.bits=e}function R(){var e,a;this.setModules=function(t,s){e=t,a=s}}function M(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}function A(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=c.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}function B(){this.linprebuf=s(2*b.MAX_ORDER),this.linpre=0,this.lstepbuf=s(b.MAX_SAMPLES_PER_WINDOW+b.MAX_ORDER),this.lstep=0,this.loutbuf=s(b.MAX_SAMPLES_PER_WINDOW+b.MAX_ORDER),this.lout=0,this.rinprebuf=s(2*b.MAX_ORDER),this.rinpre=0,this.rstepbuf=s(b.MAX_SAMPLES_PER_WINDOW+b.MAX_ORDER),this.rstep=0,this.routbuf=s(b.MAX_SAMPLES_PER_WINDOW+b.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=t(0|b.STEPS_per_dB*b.MAX_dB),this.B=t(0|b.STEPS_per_dB*b.MAX_dB)}function w(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=s(V.SBMAX_l),this.s=s(V.SBMAX_s),this.psfb21=s(V.PSFB21),this.psfb12=s(V.PSFB12),this.cb_l=s(V.CBANDS),this.cb_s=s(V.CBANDS),this.eql_w=s(V.BLKSIZE/2)}function T(e){var a=e;this.quantize=a,this.iteration_loop=function(e,a,r,n){var _,i=e.internal_flags,o=s(ae.SFBMAX),l=s(576),f=t(2),c=0,h=i.l3_side,u=new S(c);this.quantize.rv.ResvFrameBegin(e,u),c=u.bits;for(var b=0;b<i.mode_gr;b++){_=this.quantize.qupvt.on_pe(e,a,f,c,b,b),i.mode_ext==V.MPG_MD_MS_LR&&(this.quantize.ms_convert(i.l3_side,b),this.quantize.qupvt.reduce_side(f,r[b],c,_));for(var m=0;m<i.channels_out;m++){var p,v,d=h.tt[b][m];d.block_type!=V.SHORT_TYPE?(p=0,v=i.PSY.mask_adjust-p):(p=0,v=i.PSY.mask_adjust_short-p),i.masking_lower=Math.pow(10,.1*v),this.quantize.init_outer_loop(i,d),this.quantize.init_xrpow(i,d,l)&&(this.quantize.qupvt.calc_xmin(e,n[b][m],d,o),this.quantize.outer_loop(e,d,o,l,m,f[m])),this.quantize.iteration_finish_one(i,b,m)}}this.quantize.rv.ResvFrameEnd(i,c)}}function E(e,a,s,r){this.l=t(1+V.SBMAX_l),this.s=t(1+V.SBMAX_s),this.psfb21=t(1+V.PSFB21),this.psfb12=t(1+V.PSFB12);var n=this.l,_=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],W.arraycopy(this.arrL,0,n,0,Math.min(this.arrL.length,this.l.length)),W.arraycopy(this.arrS,0,_,0,Math.min(this.arrS.length,this.s.length)),W.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),W.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function k(){function e(e){return d[e+k.Q_MAX2]}function a(e,a){var t=o.ATHformula(a,e);return t-=m,t=Math.pow(10,t/10+e.ATHlower)}function r(e){for(var t=e.internal_flags.ATH.l,s=e.internal_flags.ATH.psfb21,r=e.internal_flags.ATH.s,n=e.internal_flags.ATH.psfb12,_=e.internal_flags,i=e.out_samplerate,o=0;o<V.SBMAX_l;o++){var l=_.scalefac_band.l[o],f=_.scalefac_band.l[o+1];t[o]=$.MAX_VALUE;for(var c=l;f>c;c++){var h=c*i/1152,u=a(e,h);t[o]=Math.min(t[o],u)}}for(var o=0;o<V.PSFB21;o++){var l=_.scalefac_band.psfb21[o],f=_.scalefac_band.psfb21[o+1];s[o]=$.MAX_VALUE;for(var c=l;f>c;c++){var h=c*i/1152,u=a(e,h);s[o]=Math.min(s[o],u)}}for(var o=0;o<V.SBMAX_s;o++){var l=_.scalefac_band.s[o],f=_.scalefac_band.s[o+1];r[o]=$.MAX_VALUE;for(var c=l;f>c;c++){var h=c*i/384,u=a(e,h);r[o]=Math.min(r[o],u)}r[o]*=_.scalefac_band.s[o+1]-_.scalefac_band.s[o]}for(var o=0;o<V.PSFB12;o++){var l=_.scalefac_band.psfb12[o],f=_.scalefac_band.psfb12[o+1];n[o]=$.MAX_VALUE;for(var c=l;f>c;c++){var h=c*i/384,u=a(e,h);n[o]=Math.min(n[o],u)}n[o]*=_.scalefac_band.s[13]-_.scalefac_band.s[12]}if(e.noATH){for(var o=0;o<V.SBMAX_l;o++)t[o]=1e-20;for(var o=0;o<V.PSFB21;o++)s[o]=1e-20;for(var o=0;o<V.SBMAX_s;o++)r[o]=1e-20;for(var o=0;o<V.PSFB12;o++)n[o]=1e-20}_.ATH.floor=10*Math.log10(a(e,-1))}function n(e){this.s=e}var _=null,i=null,o=null;this.setModules=function(e,a,t){_=e,i=a,o=t},this.IPOW20=function(e){return g[e]};var l=2.220446049250313e-16,c=k.IXMAX_VAL,h=c+2,u=k.Q_MAX,b=k.Q_MAX2,m=(k.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var p=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=p,this.sfBandIndex=[new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var d=s(u+b+1),g=s(u),R=s(h),A=s(h);this.adj43=A,this.iteration_init=function(e){var a,t=e.internal_flags,s=t.l3_side;if(0==t.iteration_init_init){for(t.iteration_init_init=1,s.main_data_begin=0,r(e),R[0]=0,a=1;h>a;a++)R[a]=Math.pow(a,4/3);for(a=0;h-1>a;a++)A[a]=a+1-Math.pow(.5*(R[a]+R[a+1]),.75);for(A[a]=.5,a=0;u>a;a++)g[a]=Math.pow(2,(a-210)*-.1875);for(a=0;u+b>=a;a++)d[a]=Math.pow(2,.25*(a-210-b));_.huffman_init(t);var n,i,o,l;for(a=e.exp_nspsytune>>2&63,a>=32&&(a-=64),n=Math.pow(10,a/4/10),a=e.exp_nspsytune>>8&63,a>=32&&(a-=64),i=Math.pow(10,a/4/10),a=e.exp_nspsytune>>14&63,a>=32&&(a-=64),o=Math.pow(10,a/4/10),a=e.exp_nspsytune>>20&63,a>=32&&(a-=64),l=o*Math.pow(10,a/4/10),a=0;a<V.SBMAX_l;a++){var f;f=6>=a?n:13>=a?i:20>=a?o:l,t.nsPsy.longfact[a]=f}for(a=0;a<V.SBMAX_s;a++){var f;f=5>=a?n:10>=a?i:11>=a?o:l,t.nsPsy.shortfact[a]=f}}},this.on_pe=function(e,a,s,r,n,_){var o,l,f=e.internal_flags,c=0,h=t(2),u=new S(c),b=i.ResvMaxBits(e,r,u,_);c=u.bits;var m=c+b;for(m>X.MAX_BITS_PER_GRANULE&&(m=X.MAX_BITS_PER_GRANULE),o=0,l=0;l<f.channels_out;++l)s[l]=Math.min(X.MAX_BITS_PER_CHANNEL,c/f.channels_out),h[l]=0|s[l]*a[n][l]/700-s[l],h[l]>3*r/4&&(h[l]=3*r/4),h[l]<0&&(h[l]=0),h[l]+s[l]>X.MAX_BITS_PER_CHANNEL&&(h[l]=Math.max(0,X.MAX_BITS_PER_CHANNEL-s[l])),o+=h[l];if(o>b)for(l=0;l<f.channels_out;++l)h[l]=b*h[l]/o;for(l=0;l<f.channels_out;++l)s[l]+=h[l],b-=h[l];for(o=0,l=0;l<f.channels_out;++l)o+=s[l];if(o>X.MAX_BITS_PER_GRANULE){var p=0;for(l=0;l<f.channels_out;++l)s[l]*=X.MAX_BITS_PER_GRANULE,s[l]/=o,p+=s[l]}return m},this.reduce_side=function(e,a,t,s){var r=.33*(.5-a)/.5;0>r&&(r=0),r>.5&&(r=.5);var n=0|.5*r*(e[0]+e[1]);n>X.MAX_BITS_PER_CHANNEL-e[0]&&(n=X.MAX_BITS_PER_CHANNEL-e[0]),0>n&&(n=0),e[1]>=125&&(e[1]-n>125?(e[0]<t&&(e[0]+=n),e[1]-=n):(e[0]+=e[1]-125,e[1]=125)),n=e[0]+e[1],n>s&&(e[0]=s*e[0]/n,e[1]=s*e[1]/n)},this.athAdjust=function(e,a,t){var s=90.30873362,r=94.82444863,n=J.FAST_LOG10_X(a,10),_=e*e,i=0;return n-=t,_>1e-20&&(i=1+J.FAST_LOG10_X(_,10/s)),0>i&&(i=0),n*=i,n+=t+s-r,Math.pow(10,.1*n)},this.calc_xmin=function(e,a,t,s){var r,n=0,_=e.internal_flags,i=0,o=0,c=_.ATH,h=t.xr,u=e.VBR==f.vbr_mtrh?1:0,b=_.masking_lower;for((e.VBR==f.vbr_mtrh||e.VBR==f.vbr_mt)&&(b=1),r=0;r<t.psy_lmax;r++){var m,p,d,g,S,R;p=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(c.adjust,c.l[r],c.floor):c.adjust*c.l[r],S=t.width[r],d=p/S,g=l,R=S>>1,m=0;do{var M,A;M=h[i]*h[i],m+=M,g+=d>M?M:d,i++,A=h[i]*h[i],m+=A,g+=d>A?A:d,i++}while(--R>0);if(m>p&&o++,r==V.SBPSY_l){var B=p*_.nsPsy.longfact[r];B>g&&(g=B)}if(0!=u&&(p=g),!e.ATHonly){var w=a.en.l[r];if(w>0){var B;B=m*a.thm.l[r]*b/w,0!=u&&(B*=_.nsPsy.longfact[r]),B>p&&(p=B)}}0!=u?s[n++]=p:s[n++]=p*_.nsPsy.longfact[r]}var T=575;if(t.block_type!=V.SHORT_TYPE)for(var E=576;0!=E--&&v.EQ(h[E],0);)T=E;t.max_nonzero_coeff=T;for(var k=t.sfb_smin;r<t.psymax;k++,r+=3){var S,x,y;for(y=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(c.adjust,c.s[k],c.floor):c.adjust*c.s[k],S=t.width[r],x=0;3>x;x++){var p,d,g,m=0,R=S>>1;d=y/S,g=l;do{var M,A;M=h[i]*h[i],m+=M,g+=d>M?M:d,i++,A=h[i]*h[i],m+=A,g+=d>A?A:d,i++}while(--R>0);if(m>y&&o++,k==V.SBPSY_s){var B=y*_.nsPsy.shortfact[k];B>g&&(g=B)}if(p=0!=u?g:y,!e.ATHonly&&!e.ATHshort){var w=a.en.s[k][x];if(w>0){var B;B=m*a.thm.s[k][x]*b/w,0!=u&&(B*=_.nsPsy.shortfact[k]),B>p&&(p=B)}}0!=u?s[n++]=p:s[n++]=p*_.nsPsy.shortfact[k]}e.useTemporal&&(s[n-3]>s[n-3+1]&&(s[n-3+1]+=(s[n-3]-s[n-3+1])*_.decay),s[n-3+1]>s[n-3+2]&&(s[n-3+2]+=(s[n-3+1]-s[n-3+2])*_.decay))}return o},this.calc_noise_core=function(e,a,t,r){var n=0,_=a.s,i=e.l3_enc;if(_>e.count1)for(;0!=t--;){var o;o=e.xr[_],_++,n+=o*o,o=e.xr[_],_++,n+=o*o}else if(_>e.big_values){var l=s(2);for(l[0]=0,l[1]=r;0!=t--;){var o;o=Math.abs(e.xr[_])-l[i[_]],_++,n+=o*o,o=Math.abs(e.xr[_])-l[i[_]],_++,n+=o*o}}else for(;0!=t--;){var o;o=Math.abs(e.xr[_])-R[i[_]]*r,_++,n+=o*o,o=Math.abs(e.xr[_])-R[i[_]]*r,_++,n+=o*o}return a.s=_,n},this.calc_noise=function(a,t,s,r,_){var i,o,l=0,f=0,c=0,h=0,u=0,b=-20,m=0,v=a.scalefac,d=0;for(r.over_SSD=0,i=0;i<a.psymax;i++){var g=a.global_gain-(v[d++]+(0!=a.preflag?p[i]:0)<<a.scalefac_scale+1)-8*a.subblock_gain[a.window[i]],S=0;if(null!=_&&_.step[i]==g)S=_.noise[i],m+=a.width[i],s[l++]=S/t[f++],S=_.noise_log[i];else{var R=e(g);if(o=a.width[i]>>1,m+a.width[i]>a.max_nonzero_coeff){var M;M=a.max_nonzero_coeff-m+1,o=M>0?M>>1:0}var A=new n(m);S=this.calc_noise_core(a,A,o,R),m=A.s,null!=_&&(_.step[i]=g,_.noise[i]=S),S=s[l++]=S/t[f++],S=J.FAST_LOG10(Math.max(S,1e-20)),null!=_&&(_.noise_log[i]=S)}if(null!=_&&(_.global_gain=a.global_gain),u+=S,S>0){var B;B=Math.max(0|10*S+.5,1),r.over_SSD+=B*B,c++,h+=S}b=Math.max(b,S)}return r.over_count=c,r.tot_noise=u,r.over_noise=h,r.max_noise=b,c},this.set_pinfo=function(e,a,t,r,n){var _,i,o,l,f,c=e.internal_flags,h=0==a.scalefac_scale?.5:1,u=a.scalefac,b=s(ae.SFBMAX),m=s(ae.SFBMAX),v=new M;calc_xmin(e,t,a,b),calc_noise(a,b,m,v,null);var d=0;for(i=a.sfb_lmax,a.block_type!=V.SHORT_TYPE&&0==a.mixed_block_flag&&(i=22),_=0;i>_;_++){var g=c.scalefac_band.l[_],S=c.scalefac_band.l[_+1],R=S-g;for(l=0;S>d;d++)l+=a.xr[d]*a.xr[d];l/=R,f=1e15,c.pinfo.en[r][n][_]=f*l,c.pinfo.xfsf[r][n][_]=f*b[_]*m[_]/R,t.en.l[_]>0&&!e.ATHonly?l/=t.en.l[_]:l=0,c.pinfo.thr[r][n][_]=f*Math.max(l*t.thm.l[_],c.ATH.l[_]),c.pinfo.LAMEsfb[r][n][_]=0,0!=a.preflag&&_>=11&&(c.pinfo.LAMEsfb[r][n][_]=-h*p[_]),_<V.SBPSY_l&&(c.pinfo.LAMEsfb[r][n][_]-=h*u[_])}if(a.block_type==V.SHORT_TYPE)for(i=_,_=a.sfb_smin;_<V.SBMAX_s;_++)for(var g=c.scalefac_band.s[_],S=c.scalefac_band.s[_+1],R=S-g,A=0;3>A;A++){for(l=0,o=g;S>o;o++)l+=a.xr[d]*a.xr[d],d++;l=Math.max(l/R,1e-20),f=1e15,c.pinfo.en_s[r][n][3*_+A]=f*l,c.pinfo.xfsf_s[r][n][3*_+A]=f*b[i]*m[i]/R,t.en.s[_][A]>0?l/=t.en.s[_][A]:l=0,(e.ATHonly||e.ATHshort)&&(l=0),c.pinfo.thr_s[r][n][3*_+A]=f*Math.max(l*t.thm.s[_][A],c.ATH.s[_]),c.pinfo.LAMEsfb_s[r][n][3*_+A]=-2*a.subblock_gain[A],_<V.SBPSY_s&&(c.pinfo.LAMEsfb_s[r][n][3*_+A]-=h*u[i]),i++}c.pinfo.LAMEqss[r][n]=a.global_gain,c.pinfo.LAMEmainbits[r][n]=a.part2_3_length+a.part2_length,c.pinfo.LAMEsfbits[r][n]=a.part2_length,c.pinfo.over[r][n]=v.over_count,c.pinfo.max_noise[r][n]=10*v.max_noise,c.pinfo.over_noise[r][n]=10*v.over_noise,c.pinfo.tot_noise[r][n]=10*v.tot_noise,c.pinfo.over_SSD[r][n]=v.over_SSD}}function x(){this.global_gain=0,this.sfb_count1=0,this.step=t(39),this.noise=s(39),this.noise_log=s(39)}function y(){function e(e){return new Int32Array(e)}function a(e){return new Float32Array(e)}this.xr=s(576),this.l3_enc=t(576),this.scalefac=t(ae.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=t(3),this.subblock_gain=t(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=t(ae.SFBMAX),this.window=t(ae.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=t(4),this.max_nonzero_coeff=0;var r=this;this.assign=function(t){r.xr=a(t.xr),r.l3_enc=e(t.l3_enc),r.scalefac=e(t.scalefac),r.xrpow_max=t.xrpow_max,r.part2_3_length=t.part2_3_length,r.big_values=t.big_values,r.count1=t.count1,r.global_gain=t.global_gain,r.scalefac_compress=t.scalefac_compress,r.block_type=t.block_type,r.mixed_block_flag=t.mixed_block_flag,r.table_select=e(t.table_select),r.subblock_gain=e(t.subblock_gain),r.region0_count=t.region0_count,r.region1_count=t.region1_count,r.preflag=t.preflag,r.scalefac_scale=t.scalefac_scale,r.count1table_select=t.count1table_select,r.part2_length=t.part2_length,r.sfb_lmax=t.sfb_lmax,r.sfb_smin=t.sfb_smin,r.psy_lmax=t.psy_lmax,r.sfbmax=t.sfbmax,r.psymax=t.psymax,r.sfbdivide=t.sfbdivide,r.width=e(t.width),r.window=e(t.window),r.count1bits=t.count1bits,r.sfb_partition_table=t.sfb_partition_table.slice(0),r.slen=e(t.slen),r.max_nonzero_coeff=t.max_nonzero_coeff}}function P(){function e(e,a,t,s){s=0;for(var r=0;t>=r;++r){var n=Math.abs(e.xr[r]);s+=n,a[r]=Math.sqrt(n*Math.sqrt(n)),a[r]>e.xrpow_max&&(e.xrpow_max=a[r])}return s}function a(e,a){var t=e.ATH,s=a.xr;if(a.block_type!=V.SHORT_TYPE)for(var r=!1,n=V.PSFB21-1;n>=0&&!r;n--){var _=e.scalefac_band.psfb21[n],i=e.scalefac_band.psfb21[n+1],o=p.athAdjust(t.adjust,t.psfb21[n],t.floor);e.nsPsy.longfact[21]>1e-12&&(o*=e.nsPsy.longfact[21]);for(var l=i-1;l>=_;l--){if(!(Math.abs(s[l])<o)){r=!0;break}s[l]=0}}else for(var f=0;3>f;f++)for(var r=!1,n=V.PSFB12-1;n>=0&&!r;n--){var _=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*f+(e.scalefac_band.psfb12[n]-e.scalefac_band.psfb12[0]),i=_+(e.scalefac_band.psfb12[n+1]-e.scalefac_band.psfb12[n]),c=p.athAdjust(t.adjust,t.psfb12[n],t.floor);e.nsPsy.shortfact[12]>1e-12&&(c*=e.nsPsy.shortfact[12]);for(var l=i-1;l>=_;l--){if(!(Math.abs(s[l])<c)){r=!0;break}s[l]=0}}}function t(e){this.ordinal=e}function r(e,a,s,r,n){var _,i=e.CurrentStep[r],o=!1,l=e.OldValue[r],f=t.BINSEARCH_NONE;for(a.global_gain=l,s-=a.part2_length;;){var c;if(_=d.count_bits(e,n,a,null),1==i||_==s)break;_>s?(f==t.BINSEARCH_DOWN&&(o=!0),o&&(i/=2),f=t.BINSEARCH_UP,c=i):(f==t.BINSEARCH_UP&&(o=!0),o&&(i/=2),f=t.BINSEARCH_DOWN,c=-i),a.global_gain+=c,a.global_gain<0&&(a.global_gain=0,o=!0),a.global_gain>255&&(a.global_gain=255,o=!0)}for(;_>s&&a.global_gain<255;)a.global_gain++,_=d.count_bits(e,n,a,null);return e.CurrentStep[r]=l-a.global_gain>=4?4:2,e.OldValue[r]=a.global_gain,a.part2_3_length=_,_}function n(e){for(var a=0;a<e.sfbmax;a++)if(e.scalefac[a]+e.subblock_gain[e.window[a]]==0)return!1;return!0}function _(e){return J.FAST_LOG10(.368+.632*e*e*e)}function i(e,a){for(var t=1e-37,s=0;s<a.psymax;s++)t+=_(e[s]);return Math.max(1e-20,t)}function o(e,a,t,s,r){var n;switch(e){default:case 9:a.over_count>0?(n=t.over_SSD<=a.over_SSD,t.over_SSD==a.over_SSD&&(n=t.bits<a.bits)):n=t.max_noise<0&&10*t.max_noise+t.bits<=10*a.max_noise+a.bits;break;case 0:n=t.over_count<a.over_count||t.over_count==a.over_count&&t.over_noise<a.over_noise||t.over_count==a.over_count&&v.EQ(t.over_noise,a.over_noise)&&t.tot_noise<a.tot_noise;break;case 8:t.max_noise=i(r,s);case 1:n=t.max_noise<a.max_noise;break;case 2:n=t.tot_noise<a.tot_noise;break;case 3:n=t.tot_noise<a.tot_noise&&t.max_noise<a.max_noise;break;case 4:n=t.max_noise<=0&&a.max_noise>.2||t.max_noise<=0&&a.max_noise<0&&a.max_noise>t.max_noise-.2&&t.tot_noise<a.tot_noise||t.max_noise<=0&&a.max_noise>0&&a.max_noise>t.max_noise-.2&&t.tot_noise<a.tot_noise+a.over_noise||t.max_noise>0&&a.max_noise>-.05&&a.max_noise>t.max_noise-.1&&t.tot_noise+t.over_noise<a.tot_noise+a.over_noise||t.max_noise>0&&a.max_noise>-.1&&a.max_noise>t.max_noise-.15&&t.tot_noise+t.over_noise+t.over_noise<a.tot_noise+a.over_noise+a.over_noise;break;case 5:n=t.over_noise<a.over_noise||v.EQ(t.over_noise,a.over_noise)&&t.tot_noise<a.tot_noise;break;case 6:n=t.over_noise<a.over_noise||v.EQ(t.over_noise,a.over_noise)&&(t.max_noise<a.max_noise||v.EQ(t.max_noise,a.max_noise)&&t.tot_noise<=a.tot_noise);break;case 7:n=t.over_count<a.over_count||t.over_noise<a.over_noise}return 0==a.over_count&&(n=n&&t.bits<a.bits),n}function l(e,a,t,s,r){var n,_=e.internal_flags;n=0==a.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var i=0,o=0;o<a.sfbmax;o++)i<t[o]&&(i=t[o]);var l=_.noise_shaping_amp;switch(3==l&&(l=r?2:1),l){case 2:break;case 1:i>1?i=Math.pow(i,.5):i*=.95;break;case 0:default:i>1?i=1:i*=.95}for(var f=0,o=0;o<a.sfbmax;o++){var c,h=a.width[o];if(f+=h,!(t[o]<i)){if(0!=(2&_.substep_shaping)&&(_.pseudohalf[o]=0==_.pseudohalf[o]?1:0,0==_.pseudohalf[o]&&2==_.noise_shaping_amp))return;for(a.scalefac[o]++,c=-h;0>c;c++)s[f+c]*=n,s[f+c]>a.xrpow_max&&(a.xrpow_max=s[f+c]);if(2==_.noise_shaping_amp)return}}}function c(e,a){for(var t=1.2968395546510096,s=0,r=0;r<e.sfbmax;r++){var n=e.width[r],_=e.scalefac[r];if(0!=e.preflag&&(_+=p.pretab[r]),s+=n,0!=(1&_)){_++;for(var i=-n;0>i;i++)a[s+i]*=t,a[s+i]>e.xrpow_max&&(e.xrpow_max=a[s+i])}e.scalefac[r]=_>>1}e.preflag=0,e.scalefac_scale=1}function h(e,a,t){var s,r=a.scalefac;for(s=0;s<a.sfb_lmax;s++)if(r[s]>=16)return!0;for(var n=0;3>n;n++){var _=0,i=0;for(s=a.sfb_lmax+n;s<a.sfbdivide;s+=3)_<r[s]&&(_=r[s]);for(;s<a.sfbmax;s+=3)i<r[s]&&(i=r[s]);if(!(16>_&&8>i)){if(a.subblock_gain[n]>=7)return!0;a.subblock_gain[n]++;var o=e.scalefac_band.l[a.sfb_lmax];for(s=a.sfb_lmax+n;s<a.sfbmax;s+=3){var l,f=a.width[s],c=r[s];if(c-=4>>a.scalefac_scale,c>=0)r[s]=c,o+=3*f;else{r[s]=0;var h=210+(c<<a.scalefac_scale+1);l=p.IPOW20(h),o+=f*(n+1);for(var u=-f;0>u;u++)t[o+u]*=l,t[o+u]>a.xrpow_max&&(a.xrpow_max=t[o+u]);o+=f*(3-n-1)}}var l=p.IPOW20(202);o+=a.width[s]*(n+1);for(var u=-a.width[s];0>u;u++)t[o+u]*=l,
t[o+u]>a.xrpow_max&&(a.xrpow_max=t[o+u])}}return!1}function u(e,a,t,s,r){var _=e.internal_flags;l(e,a,t,s,r);var i=n(a);return i?!1:(i=2==_.mode_gr?d.scale_bitcount(a):d.scale_bitcount_lsf(_,a))?(_.noise_shaping>1&&(U.fill(_.pseudohalf,0),0==a.scalefac_scale?(c(a,s),i=!1):a.block_type==V.SHORT_TYPE&&_.subblock_gain>0&&(i=h(_,a,s)||n(a))),i||(i=2==_.mode_gr?d.scale_bitcount(a):d.scale_bitcount_lsf(_,a)),!i):!0}var b;this.rv=null;var m;this.qupvt=null;var p,d,g=new R;this.setModules=function(e,a,t,s){b=e,m=a,this.rv=a,p=t,this.qupvt=t,d=s,g.setModules(p,d)},this.ms_convert=function(e,a){for(var t=0;576>t;++t){var s=e.tt[a][0].xr[t],r=e.tt[a][1].xr[t];e.tt[a][0].xr[t]=(s+r)*(.5*J.SQRT2),e.tt[a][1].xr[t]=(s-r)*(.5*J.SQRT2)}},this.init_xrpow=function(a,t,s){var r=0,n=0|t.max_nonzero_coeff;if(t.xrpow_max=0,U.fill(s,n,576,0),r=e(t,s,n,r),r>1e-20){var _=0;0!=(2&a.substep_shaping)&&(_=1);for(var i=0;i<t.psymax;i++)a.pseudohalf[i]=_;return!0}return U.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=V.SBPSY_l,t.sfb_smin=V.SBPSY_s,t.psy_lmax=e.sfb21_extra?V.SBMAX_l:V.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var r=0;r<V.SBMAX_l;r++)t.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],t.window[r]=3;if(t.block_type==V.SHORT_TYPE){var n=s(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?V.SBMAX_s:V.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(V.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var _=e.scalefac_band.l[t.sfb_lmax];W.arraycopy(t.xr,0,n,0,576);for(var r=t.sfb_smin;r<V.SBMAX_s;r++)for(var i=e.scalefac_band.s[r],o=e.scalefac_band.s[r+1],l=0;3>l;l++)for(var f=i;o>f;f++)t.xr[_++]=n[3*f+l];for(var c=t.sfb_lmax,r=t.sfb_smin;r<V.SBMAX_s;r++)t.width[c]=t.width[c+1]=t.width[c+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],t.window[c]=0,t.window[c+1]=1,t.window[c+2]=2,c+=3}t.count1bits=0,t.sfb_partition_table=p.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,U.fill(t.scalefac,0),a(e,t)},t.BINSEARCH_NONE=new t(0),t.BINSEARCH_UP=new t(1),t.BINSEARCH_DOWN=new t(2),this.trancate_smallspectrums=function(e,a,t,r){var n=s(ae.SFBMAX);if((0!=(4&e.substep_shaping)||a.block_type!=V.SHORT_TYPE)&&0==(128&e.substep_shaping)){p.calc_noise(a,t,n,new M,null);for(var _=0;576>_;_++){var i=0;0!=a.l3_enc[_]&&(i=Math.abs(a.xr[_])),r[_]=i}var _=0,o=8;a.block_type==V.SHORT_TYPE&&(o=6);do{var l,f,c,h,u=a.width[o];if(_+=u,!(n[o]>=1||(U.sort(r,_-u,u),v.EQ(r[_-1],0)))){l=(1-n[o])*t[o],f=0,h=0;do{var b;for(c=1;u>h+c&&!v.NEQ(r[h+_-u],r[h+_+c-u]);c++);if(b=r[h+_-u]*r[h+_-u]*c,b>l){0!=h&&(f=r[h+_-u-1]);break}l-=b,h+=c}while(u>h);if(!v.EQ(f,0))do Math.abs(a.xr[_-u])<=f&&(a.l3_enc[_-u]=0);while(--u>0)}}while(++o<a.psymax);a.part2_3_length=d.noquant_count_bits(e,a,null)}},this.outer_loop=function(e,a,t,n,_,i){var l,c=e.internal_flags,h=new y,b=s(576),m=s(ae.SFBMAX),v=new M,g=new x,S=9999999,R=!1,A=!1,B=0;if(r(c,a,i,_,n),0==c.noise_shaping)return 100;p.calc_noise(a,t,m,v,g),v.bits=a.part2_3_length,h.assign(a);var w=0;for(W.arraycopy(n,0,b,0,576);!R;){do{var T,E=new M,k=255;if(T=0!=(2&c.substep_shaping)?20:3,c.sfb21_extra){if(m[h.sfbmax]>1)break;if(h.block_type==V.SHORT_TYPE&&(m[h.sfbmax+1]>1||m[h.sfbmax+2]>1))break}if(!u(e,h,m,n,A))break;0!=h.scalefac_scale&&(k=254);var P=i-h.part2_length;if(0>=P)break;for(;(h.part2_3_length=d.count_bits(c,n,h,g))>P&&h.global_gain<=k;)h.global_gain++;if(h.global_gain>k)break;if(0==v.over_count){for(;(h.part2_3_length=d.count_bits(c,n,h,g))>S&&h.global_gain<=k;)h.global_gain++;if(h.global_gain>k)break}if(p.calc_noise(h,t,m,E,g),E.bits=h.part2_3_length,l=a.block_type!=V.SHORT_TYPE?e.quant_comp:e.quant_comp_short,l=o(l,v,E,h,m)?1:0,0!=l)S=a.part2_3_length,v=E,a.assign(h),w=0,W.arraycopy(n,0,b,0,576);else if(0==c.full_outer_loop){if(++w>T&&0==v.over_count)break;if(3==c.noise_shaping_amp&&A&&w>30)break;if(3==c.noise_shaping_amp&&A&&h.global_gain-B>15)break}}while(h.global_gain+h.scalefac_scale<255);3==c.noise_shaping_amp?A?R=!0:(h.assign(a),W.arraycopy(b,0,n,0,576),w=0,B=h.global_gain,A=!0):R=!0}return e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?W.arraycopy(b,0,n,0,576):0!=(1&c.substep_shaping)&&trancate_smallspectrums(c,a,t,n),v.over_count},this.iteration_finish_one=function(e,a,t){var s=e.l3_side,r=s.tt[a][t];d.best_scalefac_store(e,a,t,s),1==e.use_best_huffman&&d.best_huffman_divide(e,r),m.ResvAdjust(e,r)},this.VBR_encode_granule=function(e,a,t,r,n,_,i){var o,l,f=e.internal_flags,c=new y,h=s(576),u=i,b=i+1,m=(i+_)/2,p=0,v=f.sfb21_extra;U.fill(c.l3_enc,0);do m>u-42?f.sfb21_extra=!1:f.sfb21_extra=v,l=outer_loop(e,a,t,r,n,m),0>=l?(p=1,b=a.part2_3_length,c.assign(a),W.arraycopy(r,0,h,0,576),i=b-32,o=i-_,m=(i+_)/2):(_=m+32,o=i-_,m=(i+_)/2,0!=p&&(p=2,a.assign(c),W.arraycopy(h,0,r,0,576)));while(o>12);f.sfb21_extra=v,2==p&&W.arraycopy(c.l3_enc,0,a.l3_enc,0,576)},this.get_framebits=function(e,a){var t=e.internal_flags;t.bitrate_index=t.VBR_min_bitrate;var s=b.getframebits(e);t.bitrate_index=1,s=b.getframebits(e);for(var r=1;r<=t.VBR_max_bitrate;r++){t.bitrate_index=r;var n=new S(s);a[r]=m.ResvFrameBegin(e,n),s=n.bits}},this.VBR_old_prepare=function(e,a,t,s,r,n,_,i,o){var l,f=e.internal_flags,c=0,h=1,u=0;f.bitrate_index=f.VBR_max_bitrate;var b=m.ResvFrameBegin(e,new S(0))/f.mode_gr;get_framebits(e,n);for(var v=0;v<f.mode_gr;v++){var d=p.on_pe(e,a,i[v],b,v,0);f.mode_ext==V.MPG_MD_MS_LR&&(ms_convert(f.l3_side,v),p.reduce_side(i[v],t[v],b,d));for(var g=0;g<f.channels_out;++g){var R=f.l3_side.tt[v][g];R.block_type!=V.SHORT_TYPE?(c=1.28/(1+Math.exp(3.5-a[v][g]/300))-.05,l=f.PSY.mask_adjust-c):(c=2.56/(1+Math.exp(3.5-a[v][g]/300))-.14,l=f.PSY.mask_adjust_short-c),f.masking_lower=Math.pow(10,.1*l),init_outer_loop(f,R),o[v][g]=p.calc_xmin(e,s[v][g],R,r[v][g]),0!=o[v][g]&&(h=0),_[v][g]=126,u+=i[v][g]}}for(var v=0;v<f.mode_gr;v++)for(var g=0;g<f.channels_out;g++)u>n[f.VBR_max_bitrate]&&(i[v][g]*=n[f.VBR_max_bitrate],i[v][g]/=u),_[v][g]>i[v][g]&&(_[v][g]=i[v][g]);return h},this.bitpressure_strategy=function(e,a,t,s){for(var r=0;r<e.mode_gr;r++)for(var n=0;n<e.channels_out;n++){for(var _=e.l3_side.tt[r][n],i=a[r][n],o=0,l=0;l<_.psy_lmax;l++)i[o++]*=1+.029*l*l/V.SBMAX_l/V.SBMAX_l;if(_.block_type==V.SHORT_TYPE)for(var l=_.sfb_smin;l<V.SBMAX_s;l++)i[o++]*=1+.029*l*l/V.SBMAX_s/V.SBMAX_s,i[o++]*=1+.029*l*l/V.SBMAX_s/V.SBMAX_s,i[o++]*=1+.029*l*l/V.SBMAX_s/V.SBMAX_s;s[r][n]=0|Math.max(t[r][n],.9*s[r][n])}},this.VBR_new_prepare=function(e,a,t,s,r,n){var _,i=e.internal_flags,o=1,l=0,f=0;if(e.free_format){i.bitrate_index=0;var c=new S(l);_=m.ResvFrameBegin(e,c),l=c.bits,r[0]=_}else{i.bitrate_index=i.VBR_max_bitrate;var c=new S(l);m.ResvFrameBegin(e,c),l=c.bits,get_framebits(e,r),_=r[i.VBR_max_bitrate]}for(var h=0;h<i.mode_gr;h++){p.on_pe(e,a,n[h],l,h,0),i.mode_ext==V.MPG_MD_MS_LR&&ms_convert(i.l3_side,h);for(var u=0;u<i.channels_out;++u){var b=i.l3_side.tt[h][u];i.masking_lower=Math.pow(10,.1*i.PSY.mask_adjust),init_outer_loop(i,b),0!=p.calc_xmin(e,t[h][u],b,s[h][u])&&(o=0),f+=n[h][u]}}for(var h=0;h<i.mode_gr;h++)for(var u=0;u<i.channels_out;u++)f>_&&(n[h][u]*=_,n[h][u]/=f);return o},this.calc_target_bits=function(e,a,t,s,r,n){var _,i,o,l,f=e.internal_flags,c=f.l3_side,h=0;f.bitrate_index=f.VBR_max_bitrate;var u=new S(h);for(n[0]=m.ResvFrameBegin(e,u),h=u.bits,f.bitrate_index=1,h=b.getframebits(e)-8*f.sideinfo_len,r[0]=h/(f.mode_gr*f.channels_out),h=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&f.substep_shaping)&&(h*=1.09),h/=e.out_samplerate,h-=8*f.sideinfo_len,h/=f.mode_gr*f.channels_out,_=.93+.07*(11-e.compression_ratio)/5.5,.9>_&&(_=.9),_>1&&(_=1),i=0;i<f.mode_gr;i++){var v=0;for(o=0;o<f.channels_out;o++){if(s[i][o]=int(_*h),a[i][o]>700){var d=int((a[i][o]-700)/1.4),g=c.tt[i][o];s[i][o]=int(_*h),g.block_type==V.SHORT_TYPE&&h/2>d&&(d=h/2),d>3*h/2?d=3*h/2:0>d&&(d=0),s[i][o]+=d}s[i][o]>X.MAX_BITS_PER_CHANNEL&&(s[i][o]=X.MAX_BITS_PER_CHANNEL),v+=s[i][o]}if(v>X.MAX_BITS_PER_GRANULE)for(o=0;o<f.channels_out;++o)s[i][o]*=X.MAX_BITS_PER_GRANULE,s[i][o]/=v}if(f.mode_ext==V.MPG_MD_MS_LR)for(i=0;i<f.mode_gr;i++)p.reduce_side(s[i],t[i],h*f.channels_out,X.MAX_BITS_PER_GRANULE);for(l=0,i=0;i<f.mode_gr;i++)for(o=0;o<f.channels_out;o++)s[i][o]>X.MAX_BITS_PER_CHANNEL&&(s[i][o]=X.MAX_BITS_PER_CHANNEL),l+=s[i][o];if(l>n[0])for(i=0;i<f.mode_gr;i++)for(o=0;o<f.channels_out;o++)s[i][o]*=n[0],s[i][o]/=l}}function I(){this.thm=new D,this.en=new D}function H(){function e(e,a,t){for(var s=10,n=a+238-14-286,_=-15;0>_;_++){var i,o,l;i=r[s+-10],o=e[n+-224]*i,l=e[a+224]*i,i=r[s+-9],o+=e[n+-160]*i,l+=e[a+160]*i,i=r[s+-8],o+=e[n+-96]*i,l+=e[a+96]*i,i=r[s+-7],o+=e[n+-32]*i,l+=e[a+32]*i,i=r[s+-6],o+=e[n+32]*i,l+=e[a+-32]*i,i=r[s+-5],o+=e[n+96]*i,l+=e[a+-96]*i,i=r[s+-4],o+=e[n+160]*i,l+=e[a+-160]*i,i=r[s+-3],o+=e[n+224]*i,l+=e[a+-224]*i,i=r[s+-2],o+=e[a+-256]*i,l-=e[n+256]*i,i=r[s+-1],o+=e[a+-192]*i,l-=e[n+192]*i,i=r[s+0],o+=e[a+-128]*i,l-=e[n+128]*i,i=r[s+1],o+=e[a+-64]*i,l-=e[n+64]*i,i=r[s+2],o+=e[a+0]*i,l-=e[n+0]*i,i=r[s+3],o+=e[a+64]*i,l-=e[n+-64]*i,i=r[s+4],o+=e[a+128]*i,l-=e[n+-128]*i,i=r[s+5],o+=e[a+192]*i,l-=e[n+-192]*i,o*=r[s+6],i=l-o,t[30+2*_]=l+o,t[31+2*_]=r[s+7]*i,s+=18,a--,n++}var o,l,f,c;l=e[a+-16]*r[s+-10],o=e[a+-32]*r[s+-2],l+=(e[a+-48]-e[a+16])*r[s+-9],o+=e[a+-96]*r[s+-1],l+=(e[a+-80]+e[a+48])*r[s+-8],o+=e[a+-160]*r[s+0],l+=(e[a+-112]-e[a+80])*r[s+-7],o+=e[a+-224]*r[s+1],l+=(e[a+-144]+e[a+112])*r[s+-6],o-=e[a+32]*r[s+2],l+=(e[a+-176]-e[a+144])*r[s+-5],o-=e[a+96]*r[s+3],l+=(e[a+-208]+e[a+176])*r[s+-4],o-=e[a+160]*r[s+4],l+=(e[a+-240]-e[a+208])*r[s+-3],o-=e[a+224],f=o-l,c=o+l,l=t[14],o=t[15]-l,t[31]=c+l,t[30]=f+o,t[15]=f-o,t[14]=c-l;var h;h=t[28]-t[0],t[0]+=t[28],t[28]=h*r[s+-36+7],h=t[29]-t[1],t[1]+=t[29],t[29]=h*r[s+-36+7],h=t[26]-t[2],t[2]+=t[26],t[26]=h*r[s+-72+7],h=t[27]-t[3],t[3]+=t[27],t[27]=h*r[s+-72+7],h=t[24]-t[4],t[4]+=t[24],t[24]=h*r[s+-108+7],h=t[25]-t[5],t[5]+=t[25],t[25]=h*r[s+-108+7],h=t[22]-t[6],t[6]+=t[22],t[22]=h*J.SQRT2,h=t[23]-t[7],t[7]+=t[23],t[23]=h*J.SQRT2-t[7],t[7]-=t[6],t[22]-=t[7],t[23]-=t[22],h=t[6],t[6]=t[31]-h,t[31]=t[31]+h,h=t[7],t[7]=t[30]-h,t[30]=t[30]+h,h=t[22],t[22]=t[15]-h,t[15]=t[15]+h,h=t[23],t[23]=t[14]-h,t[14]=t[14]+h,h=t[20]-t[8],t[8]+=t[20],t[20]=h*r[s+-180+7],h=t[21]-t[9],t[9]+=t[21],t[21]=h*r[s+-180+7],h=t[18]-t[10],t[10]+=t[18],t[18]=h*r[s+-216+7],h=t[19]-t[11],t[11]+=t[19],t[19]=h*r[s+-216+7],h=t[16]-t[12],t[12]+=t[16],t[16]=h*r[s+-252+7],h=t[17]-t[13],t[13]+=t[17],t[17]=h*r[s+-252+7],h=-t[20]+t[24],t[20]+=t[24],t[24]=h*r[s+-216+7],h=-t[21]+t[25],t[21]+=t[25],t[25]=h*r[s+-216+7],h=t[4]-t[8],t[4]+=t[8],t[8]=h*r[s+-216+7],h=t[5]-t[9],t[5]+=t[9],t[9]=h*r[s+-216+7],h=t[0]-t[12],t[0]+=t[12],t[12]=h*r[s+-72+7],h=t[1]-t[13],t[1]+=t[13],t[13]=h*r[s+-72+7],h=t[16]-t[28],t[16]+=t[28],t[28]=h*r[s+-72+7],h=-t[17]+t[29],t[17]+=t[29],t[29]=h*r[s+-72+7],h=J.SQRT2*(t[2]-t[10]),t[2]+=t[10],t[10]=h,h=J.SQRT2*(t[3]-t[11]),t[3]+=t[11],t[11]=h,h=J.SQRT2*(-t[18]+t[26]),t[18]+=t[26],t[26]=h-t[18],h=J.SQRT2*(-t[19]+t[27]),t[19]+=t[27],t[27]=h-t[19],h=t[2],t[19]-=t[3],t[3]-=h,t[2]=t[31]-h,t[31]+=h,h=t[3],t[11]-=t[19],t[18]-=h,t[3]=t[30]-h,t[30]+=h,h=t[18],t[27]-=t[11],t[19]-=h,t[18]=t[15]-h,t[15]+=h,h=t[19],t[10]-=h,t[19]=t[14]-h,t[14]+=h,h=t[10],t[11]-=h,t[10]=t[23]-h,t[23]+=h,h=t[11],t[26]-=h,t[11]=t[22]-h,t[22]+=h,h=t[26],t[27]-=h,t[26]=t[7]-h,t[7]+=h,h=t[27],t[27]=t[6]-h,t[6]+=h,h=J.SQRT2*(t[0]-t[4]),t[0]+=t[4],t[4]=h,h=J.SQRT2*(t[1]-t[5]),t[1]+=t[5],t[5]=h,h=J.SQRT2*(t[16]-t[20]),t[16]+=t[20],t[20]=h,h=J.SQRT2*(t[17]-t[21]),t[17]+=t[21],t[21]=h,h=-J.SQRT2*(t[8]-t[12]),t[8]+=t[12],t[12]=h-t[8],h=-J.SQRT2*(t[9]-t[13]),t[9]+=t[13],t[13]=h-t[9],h=-J.SQRT2*(t[25]-t[29]),t[25]+=t[29],t[29]=h-t[25],h=-J.SQRT2*(t[24]+t[28]),t[24]-=t[28],t[28]=h-t[24],h=t[24]-t[16],t[24]=h,h=t[20]-h,t[20]=h,h=t[28]-h,t[28]=h,h=t[25]-t[17],t[25]=h,h=t[21]-h,t[21]=h,h=t[29]-h,t[29]=h,h=t[17]-t[1],t[17]=h,h=t[9]-h,t[9]=h,h=t[25]-h,t[25]=h,h=t[5]-h,t[5]=h,h=t[21]-h,t[21]=h,h=t[13]-h,t[13]=h,h=t[29]-h,t[29]=h,h=t[1]-t[0],t[1]=h,h=t[16]-h,t[16]=h,h=t[17]-h,t[17]=h,h=t[8]-h,t[8]=h,h=t[9]-h,t[9]=h,h=t[24]-h,t[24]=h,h=t[25]-h,t[25]=h,h=t[4]-h,t[4]=h,h=t[5]-h,t[5]=h,h=t[20]-h,t[20]=h,h=t[21]-h,t[21]=h,h=t[12]-h,t[12]=h,h=t[13]-h,t[13]=h,h=t[28]-h,t[28]=h,h=t[29]-h,t[29]=h,h=t[0],t[0]+=t[31],t[31]-=h,h=t[1],t[1]+=t[30],t[30]-=h,h=t[16],t[16]+=t[15],t[15]-=h,h=t[17],t[17]+=t[14],t[14]-=h,h=t[8],t[8]+=t[23],t[23]-=h,h=t[9],t[9]+=t[22],t[22]-=h,h=t[24],t[24]+=t[7],t[7]-=h,h=t[25],t[25]+=t[6],t[6]-=h,h=t[4],t[4]+=t[27],t[27]-=h,h=t[5],t[5]+=t[26],t[26]-=h,h=t[20],t[20]+=t[11],t[11]-=h,h=t[21],t[21]+=t[10],t[10]-=h,h=t[12],t[12]+=t[19],t[19]-=h,h=t[13],t[13]+=t[18],t[18]-=h,h=t[28],t[28]+=t[3],t[3]-=h,h=t[29],t[29]+=t[2],t[2]-=h}function a(e,a){for(var t=0;3>t;t++){var s,r,n,_,o,l;_=e[a+6]*i[V.SHORT_TYPE][0]-e[a+15],s=e[a+0]*i[V.SHORT_TYPE][2]-e[a+9],r=_+s,n=_-s,_=e[a+15]*i[V.SHORT_TYPE][0]+e[a+6],s=e[a+9]*i[V.SHORT_TYPE][2]+e[a+0],o=_+s,l=-_+s,s=2.069978111953089e-11*(e[a+3]*i[V.SHORT_TYPE][1]-e[a+12]),_=2.069978111953089e-11*(e[a+12]*i[V.SHORT_TYPE][1]+e[a+3]),e[a+0]=1.90752519173728e-11*r+s,e[a+15]=1.90752519173728e-11*-o+_,n=.8660254037844387*n*1.907525191737281e-11,o=.5*o*1.907525191737281e-11+_,e[a+3]=n-o,e[a+6]=n+o,r=.5*r*1.907525191737281e-11-s,l=.8660254037844387*l*1.907525191737281e-11,e[a+9]=r+l,e[a+12]=r-l,a++}}function t(e,a,t){var s,r,n,_,i,o,f,c,h,u;n=t[17]-t[9],i=t[15]-t[11],o=t[14]-t[12],f=t[0]+t[8],c=t[1]+t[7],h=t[2]+t[6],u=t[3]+t[5],e[a+17]=f+h-u-(c-t[4]),r=(f+h-u)*l[19]+(c-t[4]),s=(n-i-o)*l[18],e[a+5]=s+r,e[a+6]=s-r,_=(t[16]-t[10])*l[18],c=c*l[19]+t[4],s=n*l[12]+_+i*l[13]+o*l[14],r=-f*l[16]+c-h*l[17]+u*l[15],e[a+1]=s+r,e[a+2]=s-r,s=n*l[13]-_-i*l[14]+o*l[12],r=-f*l[17]+c-h*l[15]+u*l[16],e[a+9]=s+r,e[a+10]=s-r,s=n*l[14]-_+i*l[12]-o*l[13],r=f*l[15]-c+h*l[16]-u*l[17],e[a+13]=s+r,e[a+14]=s-r;var b,m,p,v,d,g,S,R;b=t[8]-t[0],p=t[6]-t[2],v=t[5]-t[3],d=t[17]+t[9],g=t[16]+t[10],S=t[15]+t[11],R=t[14]+t[12],e[a+0]=d+S+R+(g+t[13]),s=(d+S+R)*l[19]-(g+t[13]),r=(b-p+v)*l[18],e[a+11]=s+r,e[a+12]=s-r,m=(t[7]-t[1])*l[18],g=t[13]-g*l[19],s=d*l[15]-g+S*l[16]+R*l[17],r=b*l[14]+m+p*l[12]+v*l[13],e[a+3]=s+r,e[a+4]=s-r,s=-d*l[17]+g-S*l[15]-R*l[16],r=b*l[13]+m-p*l[14]-v*l[12],e[a+7]=s+r,e[a+8]=s-r,s=-d*l[16]+g-S*l[17]-R*l[15],r=b*l[12]-m+p*l[13]-v*l[14],e[a+15]=s+r,e[a+16]=s-r}var r=[-0.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-0.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-0.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-0.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-0.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-0.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-0.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-0.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-0.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-0.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-0.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-0.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-0.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-0.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-0.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*J.SQRT2*.5/2384e-9,.017876148*J.SQRT2*.5/2384e-9,.003134727*J.SQRT2*.5/2384e-9,.002457142*J.SQRT2*.5/2384e-9,971317e-9*J.SQRT2*.5/2384e-9,218868e-9*J.SQRT2*.5/2384e-9,101566e-9*J.SQRT2*.5/2384e-9,13828e-9*J.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],n=12,_=36,i=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],o=i[V.SHORT_TYPE],l=i[V.SHORT_TYPE],f=i[V.SHORT_TYPE],c=i[V.SHORT_TYPE],h=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(r,l,u){for(var b=l,m=286,p=0;p<r.channels_out;p++){for(var v=0;v<r.mode_gr;v++){for(var d,g=r.l3_side.tt[v][p],S=g.xr,R=0,M=r.sb_sample[p][1-v],A=0,B=0;9>B;B++)for(e(b,m,M[A]),e(b,m+32,M[A+1]),A+=2,m+=64,d=1;32>d;d+=2)M[A-1][d]*=-1;for(d=0;32>d;d++,R+=18){var w=g.block_type,T=r.sb_sample[p][v],E=r.sb_sample[p][1-v];if(0!=g.mixed_block_flag&&2>d&&(w=0),r.amp_filter[d]<1e-12)U.fill(S,R+0,R+18,0);else{if(r.amp_filter[d]<1)for(var B=0;18>B;B++)E[B][h[d]]*=r.amp_filter[d];if(w==V.SHORT_TYPE){for(var B=-n/4;0>B;B++){var k=i[V.SHORT_TYPE][B+3];S[R+3*B+9]=T[9+B][h[d]]*k-T[8-B][h[d]],S[R+3*B+18]=T[14-B][h[d]]*k+T[15+B][h[d]],S[R+3*B+10]=T[15+B][h[d]]*k-T[14-B][h[d]],S[R+3*B+19]=E[2-B][h[d]]*k+E[3+B][h[d]],S[R+3*B+11]=E[3+B][h[d]]*k-E[2-B][h[d]],S[R+3*B+20]=E[8-B][h[d]]*k+E[9+B][h[d]]}a(S,R)}else{for(var x=s(18),B=-_/4;0>B;B++){var y,P;y=i[w][B+27]*E[B+9][h[d]]+i[w][B+36]*E[8-B][h[d]],P=i[w][B+9]*T[B+9][h[d]]-i[w][B+18]*T[8-B][h[d]],x[B+9]=y-P*o[3+B+9],x[B+18]=y*o[3+B+9]+P}t(S,R,x)}}if(w!=V.SHORT_TYPE&&0!=d)for(var B=7;B>=0;--B){var I,H;I=S[R+B]*f[20+B]+S[R+-1-B]*c[28+B],H=S[R+B]*c[28+B]-S[R+-1-B]*f[20+B],S[R+-1-B]=I,S[R+B]=H}}}if(b=u,m=286,1==r.mode_gr)for(var O=0;18>O;O++)W.arraycopy(r.sb_sample[p][1][O],0,r.sb_sample[p][0][O],0,32)}}}function V(){function e(e){var a,t;if(0==e.ATH.useAdjust)return void(e.ATH.adjust=1);if(t=e.loudness_sq[0][0],a=e.loudness_sq[1][0],2==e.channels_out?(t+=e.loudness_sq[0][1],a+=e.loudness_sq[1][1]):(t+=t,a+=a),2==e.mode_gr&&(t=Math.max(t,a)),t*=.5,t*=e.ATH.aaSensitivityP,t>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var s=31.98*t+625e-6;e.ATH.adjust>=s?(e.ATH.adjust*=.075*s+.925,e.ATH.adjust<s&&(e.ATH.adjust=s)):e.ATH.adjustLimit>=s?e.ATH.adjust=s:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=s}}function a(e){var a,t;for(e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),a=0;a<e.mode_gr;++a)for(t=0;t<e.channels_out;++t){var s=0|e.l3_side.tt[a][t].block_type;0!=e.l3_side.tt[a][t].mixed_block_flag&&(s=4),e.bitrate_blockType_Hist[e.bitrate_index][s]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][s]++,e.bitrate_blockType_Hist[15][5]++}}function r(e,a){var t,r,n=e.internal_flags;if(0==n.lame_encode_frame_init){var _,i,o=s(2014),l=s(2014);for(n.lame_encode_frame_init=1,_=0,i=0;_<286+576*(1+n.mode_gr);++_)_<576*n.mode_gr?(o[_]=0,2==n.channels_out&&(l[_]=0)):(o[_]=a[0][i],2==n.channels_out&&(l[_]=a[1][i]),++i);for(r=0;r<n.mode_gr;r++)for(t=0;t<n.channels_out;t++)n.l3_side.tt[r][t].block_type=V.SHORT_TYPE;m.mdct_sub48(n,o,l)}}var _=V.FFTOFFSET,i=V.MPG_MD_MS_LR,l=null;this.psy=null;var h=null,u=null,b=null;this.setModules=function(e,a,t,s){l=e,this.psy=a,h=a,u=s,b=t};var m=new H;this.lame_encode_mp3_frame=function(s,p,v,d,g,S){var R,M=o([2,2]);M[0][0]=new I,M[0][1]=new I,M[1][0]=new I,M[1][1]=new I;var A=o([2,2]);A[0][0]=new I,A[0][1]=new I,A[1][0]=new I,A[1][1]=new I;var B,w,T,E,k=[null,null],x=s.internal_flags,y=n([2,4]),P=[.5,.5],H=[[0,0],[0,0]],O=[[0,0],[0,0]];if(k[0]=p,k[1]=v,0==x.lame_encode_frame_init&&r(s,k),x.padding=0,(x.slot_lag-=x.frac_SpF)<0&&(x.slot_lag+=s.out_samplerate,x.padding=1),0!=x.psymodel){var L,N=[null,null],D=0,X=t(2);for(E=0;E<x.mode_gr;E++){for(T=0;T<x.channels_out;T++)N[T]=k[T],D=576+576*E-V.FFTOFFSET;if(L=s.VBR==f.vbr_mtrh||s.VBR==f.vbr_mt?h.L3psycho_anal_vbr(s,N,D,E,M,A,H[E],O[E],y[E],X):h.L3psycho_anal_ns(s,N,D,E,M,A,H[E],O[E],y[E],X),0!=L)return-4;for(s.mode==c.JOINT_STEREO&&(P[E]=y[E][2]+y[E][3],P[E]>0&&(P[E]=y[E][3]/P[E])),T=0;T<x.channels_out;T++){var Y=x.l3_side.tt[E][T];Y.block_type=X[T],Y.mixed_block_flag=0}}}else for(E=0;E<x.mode_gr;E++)for(T=0;T<x.channels_out;T++)x.l3_side.tt[E][T].block_type=V.NORM_TYPE,x.l3_side.tt[E][T].mixed_block_flag=0,O[E][T]=H[E][T]=700;if(e(x),m.mdct_sub48(x,k[0],k[1]),x.mode_ext=V.MPG_MD_LR_LR,s.force_ms)x.mode_ext=V.MPG_MD_MS_LR;else if(s.mode==c.JOINT_STEREO){var q=0,C=0;for(E=0;E<x.mode_gr;E++)for(T=0;T<x.channels_out;T++)q+=O[E][T],C+=H[E][T];if(1*C>=q){var F=x.l3_side.tt[0],j=x.l3_side.tt[x.mode_gr-1];F[0].block_type==F[1].block_type&&j[0].block_type==j[1].block_type&&(x.mode_ext=V.MPG_MD_MS_LR)}}if(x.mode_ext==i?(B=A,w=O):(B=M,w=H),s.analysis&&null!=x.pinfo)for(E=0;E<x.mode_gr;E++)for(T=0;T<x.channels_out;T++)x.pinfo.ms_ratio[E]=x.ms_ratio[E],x.pinfo.ms_ener_ratio[E]=P[E],x.pinfo.blocktype[E][T]=x.l3_side.tt[E][T].block_type,x.pinfo.pe[E][T]=w[E][T],W.arraycopy(x.l3_side.tt[E][T].xr,0,x.pinfo.xr[E][T],0,576),x.mode_ext==i&&(x.pinfo.ers[E][T]=x.pinfo.ers[E][T+2],W.arraycopy(x.pinfo.energy[E][T+2],0,x.pinfo.energy[E][T],0,x.pinfo.energy[E][T].length));if(s.VBR==f.vbr_off||s.VBR==f.vbr_abr){var G,z;for(G=0;18>G;G++)x.nsPsy.pefirbuf[G]=x.nsPsy.pefirbuf[G+1];for(z=0,E=0;E<x.mode_gr;E++)for(T=0;T<x.channels_out;T++)z+=w[E][T];for(x.nsPsy.pefirbuf[18]=z,z=x.nsPsy.pefirbuf[9],G=0;9>G;G++)z+=(x.nsPsy.pefirbuf[G]+x.nsPsy.pefirbuf[18-G])*V.fircoef[G];for(z=3350*x.mode_gr*x.channels_out/z,E=0;E<x.mode_gr;E++)for(T=0;T<x.channels_out;T++)w[E][T]*=z}if(x.iteration_loop.iteration_loop(s,w,P,B),l.format_bitstream(s),R=l.copy_buffer(x,d,g,S,1),s.bWriteVbrTag&&u.addVbrFrame(s),s.analysis&&null!=x.pinfo){for(T=0;T<x.channels_out;T++){var K;for(K=0;_>K;K++)x.pinfo.pcmdata[T][K]=x.pinfo.pcmdata[T][K+s.framesize];for(K=_;1600>K;K++)x.pinfo.pcmdata[T][K]=k[T][K-_]}b.set_frame_pinfo(s,B)}return a(x),R}}function O(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}function L(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[t(4),t(4)];for(var e=0;2>e;e++)for(var a=0;2>a;a++)this.tt[e][a]=new y}function N(){this.last_en_subshort=n([4,9]),this.lastAttacks=t(4),this.pefirbuf=s(19),this.longfact=s(V.SBMAX_l),this.shortfact=s(V.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function D(){this.l=s(V.SBMAX_l),this.s=n([V.SBMAX_s,3]);var e=this;this.assign=function(a){W.arraycopy(a.l,0,e.l,0,V.SBMAX_l);for(var t=0;t<V.SBMAX_s;t++)for(var s=0;3>s;s++)e.s[t][s]=a.s[t][s]}}function X(){function a(){this.write_timing=0,this.ptr=0,this.buf=e(i)}var i=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=n([2,X.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new L,this.ms_ratio=s(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=t(2),this.CurrentStep=t(2),this.masking_lower=0,this.bv_scf=t(576),this.pseudohalf=t(ae.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*X.BPC+1),this.itime=r(2),this.sideinfo_len=0,this.sb_sample=n([2,2,18,V.SBLIMIT]),this.amp_filter=s(32),this.header=new Array(X.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new E,this.minval_l=s(V.CBANDS),this.minval_s=s(V.CBANDS),this.nb_1=n([4,V.CBANDS]),this.nb_2=n([4,V.CBANDS]),this.nb_s1=n([4,V.CBANDS]),this.nb_s2=n([4,V.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=s(4),this.loudness_sq=n([2,2]),this.loudness_sq_save=s(2),this.mld_l=s(V.SBMAX_l),this.mld_s=s(V.SBMAX_s),this.bm_l=t(V.SBMAX_l),this.bo_l=t(V.SBMAX_l),this.bm_s=t(V.SBMAX_s),this.bo_s=t(V.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=_([V.CBANDS,2]),this.s3ind_s=_([V.CBANDS,2]),this.numlines_s=t(V.CBANDS),this.numlines_l=t(V.CBANDS),this.rnumlines_l=s(V.CBANDS),this.mld_cb_l=s(V.CBANDS),this.mld_cb_s=s(V.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=s(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=t(2),this.nsPsy=new N,this.VBR_seek_table=new O,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=_([16,5]),this.bitrate_blockType_Hist=_([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var o=0;o<this.en.length;o++)this.en[o]=new D;for(var o=0;o<this.thm.length;o++)this.thm[o]=new D;
for(var o=0;o<this.header.length;o++)this.header[o]=new a}function Y(){function e(e,a,t){var s,n,_,i=0;t<<=1;var o=a+t;s=4;do{var l,f,c,h,u,b,m;m=s>>1,h=s,u=s<<1,b=u+h,s=u<<1,n=a,_=n+m;do{var p,v,d,g;v=e[n+0]-e[n+h],p=e[n+0]+e[n+h],g=e[n+u]-e[n+b],d=e[n+u]+e[n+b],e[n+u]=p-d,e[n+0]=p+d,e[n+b]=v-g,e[n+h]=v+g,v=e[_+0]-e[_+h],p=e[_+0]+e[_+h],g=J.SQRT2*e[_+b],d=J.SQRT2*e[_+u],e[_+u]=p-d,e[_+0]=p+d,e[_+b]=v-g,e[_+h]=v+g,_+=s,n+=s}while(o>n);for(f=r[i+0],l=r[i+1],c=1;m>c;c++){var S,R;S=1-2*l*l,R=2*l*f,n=a+c,_=a+h-c;do{var M,A,B,p,v,w,d,T,g,E;A=R*e[n+h]-S*e[_+h],M=S*e[n+h]+R*e[_+h],v=e[n+0]-M,p=e[n+0]+M,w=e[_+0]-A,B=e[_+0]+A,A=R*e[n+b]-S*e[_+b],M=S*e[n+b]+R*e[_+b],g=e[n+u]-M,d=e[n+u]+M,E=e[_+u]-A,T=e[_+u]+A,A=l*d-f*E,M=f*d+l*E,e[n+u]=p-M,e[n+0]=p+M,e[_+b]=w-A,e[_+h]=w+A,A=f*T-l*g,M=l*T+f*g,e[_+u]=B-M,e[_+0]=B+M,e[n+b]=v-A,e[n+h]=v+A,_+=s,n+=s}while(o>n);S=f,f=S*r[i+0]-l*r[i+1],l=S*r[i+1]+l*r[i+0]}i+=2}while(t>s)}var a=s(V.BLKSIZE),t=s(V.BLKSIZE_s/2),r=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],n=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(a,s,r,_,i){for(var o=0;3>o;o++){var l=V.BLKSIZE_s/2,f=65535&192*(o+1),c=V.BLKSIZE_s/8-1;do{var h,u,b,m,p,v=255&n[c<<2];h=t[v]*_[r][i+v+f],p=t[127-v]*_[r][i+v+f+128],u=h-p,h+=p,b=t[v+64]*_[r][i+v+f+64],p=t[63-v]*_[r][i+v+f+192],m=b-p,b+=p,l-=4,s[o][l+0]=h+b,s[o][l+2]=h-b,s[o][l+1]=u+m,s[o][l+3]=u-m,h=t[v+1]*_[r][i+v+f+1],p=t[126-v]*_[r][i+v+f+129],u=h-p,h+=p,b=t[v+65]*_[r][i+v+f+65],p=t[62-v]*_[r][i+v+f+193],m=b-p,b+=p,s[o][l+V.BLKSIZE_s/2+0]=h+b,s[o][l+V.BLKSIZE_s/2+2]=h-b,s[o][l+V.BLKSIZE_s/2+1]=u+m,s[o][l+V.BLKSIZE_s/2+3]=u-m}while(--c>=0);e(s[o],l,V.BLKSIZE_s/2)}},this.fft_long=function(t,s,r,_,i){var o=V.BLKSIZE/8-1,l=V.BLKSIZE/2;do{var f,c,h,u,b,m=255&n[o];f=a[m]*_[r][i+m],b=a[m+512]*_[r][i+m+512],c=f-b,f+=b,h=a[m+256]*_[r][i+m+256],b=a[m+768]*_[r][i+m+768],u=h-b,h+=b,l-=4,s[l+0]=f+h,s[l+2]=f-h,s[l+1]=c+u,s[l+3]=c-u,f=a[m+1]*_[r][i+m+1],b=a[m+513]*_[r][i+m+513],c=f-b,f+=b,h=a[m+257]*_[r][i+m+257],b=a[m+769]*_[r][i+m+769],u=h-b,h+=b,s[l+V.BLKSIZE/2+0]=f+h,s[l+V.BLKSIZE/2+2]=f-h,s[l+V.BLKSIZE/2+1]=c+u,s[l+V.BLKSIZE/2+3]=c-u}while(--o>=0);e(s,l,V.BLKSIZE/2)},this.init_fft=function(e){for(var s=0;s<V.BLKSIZE;s++)a[s]=.42-.5*Math.cos(2*Math.PI*(s+.5)/V.BLKSIZE)+.08*Math.cos(4*Math.PI*(s+.5)/V.BLKSIZE);for(var s=0;s<V.BLKSIZE_s/2;s++)t[s]=.5*(1-Math.cos(2*Math.PI*(s+.5)/V.BLKSIZE_s))}}function q(){function e(e){return e}function a(e,a){for(var t=0,s=0;s<V.BLKSIZE/2;++s)t+=e[s]*a.ATH.eql_w[s];return t*=ne}function r(t,s,r,n,_,i,o,l,f,c,h){var u=t.internal_flags;if(2>f)Q.fft_long(u,n[_],f,c,h),Q.fft_short(u,i[o],f,c,h);else if(2==f){for(var b=V.BLKSIZE-1;b>=0;--b){var m=n[_+0][b],p=n[_+1][b];n[_+0][b]=(m+p)*J.SQRT2*.5,n[_+1][b]=(m-p)*J.SQRT2*.5}for(var v=2;v>=0;--v)for(var b=V.BLKSIZE_s-1;b>=0;--b){var m=i[o+0][v][b],p=i[o+1][v][b];i[o+0][v][b]=(m+p)*J.SQRT2*.5,i[o+1][v][b]=(m-p)*J.SQRT2*.5}}s[0]=e(n[_+0][0]),s[0]*=s[0];for(var b=V.BLKSIZE/2-1;b>=0;--b){var d=n[_+0][V.BLKSIZE/2-b],g=n[_+0][V.BLKSIZE/2+b];s[V.BLKSIZE/2-b]=e(.5*(d*d+g*g))}for(var v=2;v>=0;--v){r[v][0]=i[o+0][v][0],r[v][0]*=r[v][0];for(var b=V.BLKSIZE_s/2-1;b>=0;--b){var d=i[o+0][v][V.BLKSIZE_s/2-b],g=i[o+0][v][V.BLKSIZE_s/2+b];r[v][V.BLKSIZE_s/2-b]=e(.5*(d*d+g*g))}}for(var S=0,b=11;b<V.HBLKSIZE;b++)S+=s[b];if(u.tot_ener[f]=S,t.analysis){for(var b=0;b<V.HBLKSIZE;b++)u.pinfo.energy[l][f][b]=u.pinfo.energy_save[f][b],u.pinfo.energy_save[f][b]=s[b];u.pinfo.pe[l][f]=u.pe[f]}2==t.athaa_loudapprox&&2>f&&(u.loudness_sq[l][f]=u.loudness_sq_save[f],u.loudness_sq_save[f]=a(s,u))}function _(){z=Math.pow(10,(ue+1)/16),K=Math.pow(10,(be+1)/16),Z=Math.pow(10,me/10)}function i(e,a,t,s,r,n){var _;if(a>e){if(!(e*K>a))return e+a;_=a/e}else{if(e>=a*K)return e+a;_=e/a}if(e+=a,6>=s+3){if(_>=z)return e;var i=0|J.FAST_LOG10_X(_,16);return e*de[i]}var i=0|J.FAST_LOG10_X(_,16);if(a=0!=n?r.ATH.cb_s[t]*r.ATH.adjust:r.ATH.cb_l[t]*r.ATH.adjust,Z*a>e){if(e>a){var o,l;return o=1,13>=i&&(o=ge[i]),l=J.FAST_LOG10_X(e/a,10/15),e*((ve[i]-o)*l+o)}return i>13?e:e*ge[i]}return e*ve[i]}function o(e,a,t){var s;if(0>e&&(e=0),0>a&&(a=0),0>=e)return a;if(0>=a)return e;if(s=a>e?a/e:e/a,t>=-2&&2>=t){if(s>=z)return e+a;var r=0|J.FAST_LOG10_X(s,16);return(e+a)*Se[r]}return K>s?e+a:(a>e&&(e=a),e)}function h(e,a){var t=e.internal_flags;if(t.channels_out>1){for(var s=0;s<V.SBMAX_l;s++){var r=t.thm[0].l[s],n=t.thm[1].l[s];t.thm[0].l[s]+=n*a,t.thm[1].l[s]+=r*a}for(var s=0;s<V.SBMAX_s;s++)for(var _=0;3>_;_++){var r=t.thm[0].s[s][_],n=t.thm[1].s[s][_];t.thm[0].s[s][_]+=n*a,t.thm[1].s[s][_]+=r*a}}}function u(e){for(var a=0;a<V.SBMAX_l;a++)if(!(e.thm[0].l[a]>1.58*e.thm[1].l[a]||e.thm[1].l[a]>1.58*e.thm[0].l[a])){var t=e.mld_l[a]*e.en[3].l[a],s=Math.max(e.thm[2].l[a],Math.min(e.thm[3].l[a],t));t=e.mld_l[a]*e.en[2].l[a];var r=Math.max(e.thm[3].l[a],Math.min(e.thm[2].l[a],t));e.thm[2].l[a]=s,e.thm[3].l[a]=r}for(var a=0;a<V.SBMAX_s;a++)for(var n=0;3>n;n++)if(!(e.thm[0].s[a][n]>1.58*e.thm[1].s[a][n]||e.thm[1].s[a][n]>1.58*e.thm[0].s[a][n])){var t=e.mld_s[a]*e.en[3].s[a][n],s=Math.max(e.thm[2].s[a][n],Math.min(e.thm[3].s[a][n],t));t=e.mld_s[a]*e.en[2].s[a][n];var r=Math.max(e.thm[3].s[a][n],Math.min(e.thm[2].s[a][n],t));e.thm[2].s[a][n]=s,e.thm[3].s[a][n]=r}}function b(e,a,t){var s=a,r=Math.pow(10,t);a*=2,s*=2;for(var n=0;n<V.SBMAX_l;n++){var _,i,o,l;if(l=e.ATH.cb_l[e.bm_l[n]]*r,_=Math.min(Math.max(e.thm[0].l[n],l),Math.max(e.thm[1].l[n],l)),i=Math.max(e.thm[2].l[n],l),o=Math.max(e.thm[3].l[n],l),i+o>_*a){var f=_*s/(i+o);i*=f,o*=f}e.thm[2].l[n]=Math.min(i,e.thm[2].l[n]),e.thm[3].l[n]=Math.min(o,e.thm[3].l[n])}r*=V.BLKSIZE_s/V.BLKSIZE;for(var n=0;n<V.SBMAX_s;n++)for(var c=0;3>c;c++){var _,i,o,l;if(l=e.ATH.cb_s[e.bm_s[n]]*r,_=Math.min(Math.max(e.thm[0].s[n][c],l),Math.max(e.thm[1].s[n][c],l)),i=Math.max(e.thm[2].s[n][c],l),o=Math.max(e.thm[3].s[n][c],l),i+o>_*a){var f=_*a/(i+o);i*=f,o*=f}e.thm[2].s[n][c]=Math.min(e.thm[2].s[n][c],i),e.thm[3].s[n][c]=Math.min(e.thm[3].s[n][c],o)}}function m(e,a,t,s,r){var n,_,i=0,o=0;for(n=_=0;n<V.SBMAX_s;++_,++n){for(var l=e.bo_s[n],f=e.npart_s,c=f>l?l:f;c>_;)i+=a[_],o+=t[_],_++;if(e.en[s].s[n][r]=i,e.thm[s].s[n][r]=o,_>=f){++n;break}var h=e.PSY.bo_s_weight[n],u=1-h;i=h*a[_],o=h*t[_],e.en[s].s[n][r]+=i,e.thm[s].s[n][r]+=o,i=u*a[_],o=u*t[_]}for(;n<V.SBMAX_s;++n)e.en[s].s[n][r]=0,e.thm[s].s[n][r]=0}function p(e,a,t,s){var r,n,_=0,i=0;for(r=n=0;r<V.SBMAX_l;++n,++r){for(var o=e.bo_l[r],l=e.npart_l,f=l>o?o:l;f>n;)_+=a[n],i+=t[n],n++;if(e.en[s].l[r]=_,e.thm[s].l[r]=i,n>=l){++r;break}var c=e.PSY.bo_l_weight[r],h=1-c;_=c*a[n],i=c*t[n],e.en[s].l[r]+=_,e.thm[s].l[r]+=i,_=h*a[n],i=h*t[n]}for(;r<V.SBMAX_l;++r)e.en[s].l[r]=0,e.thm[s].l[r]=0}function v(e,a,t,s,r,n){var _,i,o=e.internal_flags;for(i=_=0;i<o.npart_s;++i){for(var l=0,f=0,c=o.numlines_s[i],h=0;c>h;++h,++_){var u=a[n][_];l+=u,u>f&&(f=u)}t[i]=l}for(_=i=0;i<o.npart_s;i++){var b=o.s3ind_s[i][0],m=o.s3_ss[_++]*t[b];for(++b;b<=o.s3ind_s[i][1];)m+=o.s3_ss[_]*t[b],++_,++b;var p=te*o.nb_s1[r][i];if(s[i]=Math.min(m,p),o.blocktype_old[1&r]==V.SHORT_TYPE){var p=se*o.nb_s2[r][i],v=s[i];s[i]=Math.min(p,v)}o.nb_s2[r][i]=o.nb_s1[r][i],o.nb_s1[r][i]=m}for(;i<=V.CBANDS;++i)t[i]=0,s[i]=0}function d(e,a,t,s){var r=e.internal_flags;e.short_blocks!=l.short_block_coupled||0!=a[0]&&0!=a[1]||(a[0]=a[1]=0);for(var n=0;n<r.channels_out;n++)s[n]=V.NORM_TYPE,e.short_blocks==l.short_block_dispensed&&(a[n]=1),e.short_blocks==l.short_block_forced&&(a[n]=0),0!=a[n]?r.blocktype_old[n]==V.SHORT_TYPE&&(s[n]=V.STOP_TYPE):(s[n]=V.SHORT_TYPE,r.blocktype_old[n]==V.NORM_TYPE&&(r.blocktype_old[n]=V.START_TYPE),r.blocktype_old[n]==V.STOP_TYPE&&(r.blocktype_old[n]=V.SHORT_TYPE)),t[n]=r.blocktype_old[n],r.blocktype_old[n]=s[n]}function g(e,a,t){return t>=1?e:0>=t?a:a>0?Math.pow(e/a,t)*a:0}function S(e,a){for(var t=309.07,s=0;s<V.SBMAX_s-1;s++)for(var r=0;3>r;r++){var n=e.thm.s[s][r];if(n>0){var _=n*a,i=e.en.s[s][r];i>_&&(t+=i>1e10*_?Re[s]*(10*W):Re[s]*J.FAST_LOG10(i/_))}}return t}function R(e,a){for(var t=281.0575,s=0;s<V.SBMAX_l-1;s++){var r=e.thm.l[s];if(r>0){var n=r*a,_=e.en.l[s];_>n&&(t+=_>1e10*n?Me[s]*(10*W):Me[s]*J.FAST_LOG10(_/n))}}return t}function M(e,a,t,s,r){var n,_;for(n=_=0;n<e.npart_l;++n){var i,o=0,l=0;for(i=0;i<e.numlines_l[n];++i,++_){var f=a[_];o+=f,f>l&&(l=f)}t[n]=o,s[n]=l,r[n]=o*e.rnumlines_l[n]}}function A(e,a,t,s){var r=pe.length-1,n=0,_=t[n]+t[n+1];if(_>0){var i=a[n];i<a[n+1]&&(i=a[n+1]),_=20*(2*i-_)/(_*(e.numlines_l[n]+e.numlines_l[n+1]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0;for(n=1;n<e.npart_l-1;n++)if(_=t[n-1]+t[n]+t[n+1],_>0){var i=a[n-1];i<a[n]&&(i=a[n]),i<a[n+1]&&(i=a[n+1]),_=20*(3*i-_)/(_*(e.numlines_l[n-1]+e.numlines_l[n]+e.numlines_l[n+1]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0;if(_=t[n-1]+t[n],_>0){var i=a[n-1];i<a[n]&&(i=a[n]),_=20*(2*i-_)/(_*(e.numlines_l[n-1]+e.numlines_l[n]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0}function B(a,t,s,r,n,_,i,o){var l=a.internal_flags;if(2>r)Q.fft_long(l,i[o],r,t,s);else if(2==r)for(var f=V.BLKSIZE-1;f>=0;--f){var c=i[o+0][f],h=i[o+1][f];i[o+0][f]=(c+h)*J.SQRT2*.5,i[o+1][f]=(c-h)*J.SQRT2*.5}_[0]=e(i[o+0][0]),_[0]*=_[0];for(var f=V.BLKSIZE/2-1;f>=0;--f){var u=i[o+0][V.BLKSIZE/2-f],b=i[o+0][V.BLKSIZE/2+f];_[V.BLKSIZE/2-f]=e(.5*(u*u+b*b))}for(var m=0,f=11;f<V.HBLKSIZE;f++)m+=_[f];if(l.tot_ener[r]=m,a.analysis){for(var f=0;f<V.HBLKSIZE;f++)l.pinfo.energy[n][r][f]=l.pinfo.energy_save[r][f],l.pinfo.energy_save[r][f]=_[f];l.pinfo.pe[n][r]=l.pe[r]}}function w(a,t,s,r,n,_,i,o){var l=a.internal_flags;if(0==n&&2>r&&Q.fft_short(l,i[o],r,t,s),2==r)for(var f=V.BLKSIZE_s-1;f>=0;--f){var c=i[o+0][n][f],h=i[o+1][n][f];i[o+0][n][f]=(c+h)*J.SQRT2*.5,i[o+1][n][f]=(c-h)*J.SQRT2*.5}_[n][0]=i[o+0][n][0],_[n][0]*=_[n][0];for(var f=V.BLKSIZE_s/2-1;f>=0;--f){var u=i[o+0][n][V.BLKSIZE_s/2-f],b=i[o+0][n][V.BLKSIZE_s/2+f];_[n][V.BLKSIZE_s/2-f]=e(.5*(u*u+b*b))}}function T(e,t,s,r){var n=e.internal_flags;2==e.athaa_loudapprox&&2>s&&(n.loudness_sq[t][s]=n.loudness_sq_save[s],n.loudness_sq_save[s]=a(r,n))}function E(e,a,t,r,_,i,o,l,f,h){for(var u=n([2,576]),b=e.internal_flags,m=b.channels_out,p=e.mode==c.JOINT_STEREO?4:m,v=0;m>v;v++){firbuf=a[v];for(var d=t+576-350-ce+192,g=0;576>g;g++){var S,R;S=firbuf[d+g+10],R=0;for(var M=0;(ce-1)/2-1>M;M+=2)S+=Be[M]*(firbuf[d+g+M]+firbuf[d+g+ce-M]),R+=Be[M+1]*(firbuf[d+g+M+1]+firbuf[d+g+ce-M-1]);u[v][g]=S+R}_[r][v].en.assign(b.en[v]),_[r][v].thm.assign(b.thm[v]),p>2&&(i[r][v].en.assign(b.en[v+2]),i[r][v].thm.assign(b.thm[v+2]))}for(var v=0;p>v;v++){var A=s(12),B=s(12),w=[0,0,0,0],T=u[1&v],E=0,k=3==v?b.nsPsy.attackthre_s:b.nsPsy.attackthre,x=1;if(2==v)for(var g=0,M=576;M>0;++g,--M){var y=u[0][g],P=u[1][g];u[0][g]=y+P,u[1][g]=y-P}for(var g=0;3>g;g++)B[g]=b.nsPsy.last_en_subshort[v][g+6],A[g]=B[g]/b.nsPsy.last_en_subshort[v][g+4],w[0]+=B[g];for(var g=0;9>g;g++){for(var I=E+64,H=1;I>E;E++)H<Math.abs(T[E])&&(H=Math.abs(T[E]));b.nsPsy.last_en_subshort[v][g]=B[g+3]=H,w[1+g/3]+=H,H>B[g+3-2]?H/=B[g+3-2]:H=B[g+3-2]>10*H?B[g+3-2]/(10*H):0,A[g+3]=H}for(var g=0;3>g;++g){var V=B[3*g+3]+B[3*g+4]+B[3*g+5],O=1;6*B[3*g+5]<V&&(O*=.5,6*B[3*g+4]<V&&(O*=.5)),l[v][g]=O}if(e.analysis){for(var L=A[0],g=1;12>g;g++)L<A[g]&&(L=A[g]);b.pinfo.ers[r][v]=b.pinfo.ers_save[v],b.pinfo.ers_save[v]=L}for(var g=0;12>g;g++)0==f[v][g/3]&&A[g]>k&&(f[v][g/3]=g%3+1);for(var g=1;4>g;g++){var N=w[g-1],D=w[g],X=Math.max(N,D);4e4>X&&1.7*D>N&&1.7*N>D&&(1==g&&f[v][0]<=f[v][g]&&(f[v][0]=0),f[v][g]=0)}f[v][0]<=b.nsPsy.lastAttacks[v]&&(f[v][0]=0),(3==b.nsPsy.lastAttacks[v]||f[v][0]+f[v][1]+f[v][2]+f[v][3]!=0)&&(x=0,0!=f[v][1]&&0!=f[v][0]&&(f[v][1]=0),0!=f[v][2]&&0!=f[v][1]&&(f[v][2]=0),0!=f[v][3]&&0!=f[v][2]&&(f[v][3]=0)),2>v?h[v]=x:0==x&&(h[0]=h[1]=0),o[v]=b.tot_ener[v]}}function k(e,a,t){if(0==t)for(var s=0;s<e.npart_s;s++)e.nb_s2[a][s]=e.nb_s1[a][s],e.nb_s1[a][s]=0}function x(e,a){for(var t=0;t<e.npart_l;t++)e.nb_2[a][t]=e.nb_1[a][t],e.nb_1[a][t]=0}function y(e,a,t,s){var r=pe.length-1,n=0,_=t[n]+t[n+1];if(_>0){var i=a[n];i<a[n+1]&&(i=a[n+1]),_=20*(2*i-_)/(_*(e.numlines_s[n]+e.numlines_s[n+1]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0;for(n=1;n<e.npart_s-1;n++)if(_=t[n-1]+t[n]+t[n+1],_>0){var i=a[n-1];i<a[n]&&(i=a[n]),i<a[n+1]&&(i=a[n+1]),_=20*(3*i-_)/(_*(e.numlines_s[n-1]+e.numlines_s[n]+e.numlines_s[n+1]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0;if(_=t[n-1]+t[n],_>0){var i=a[n-1];i<a[n]&&(i=a[n]),_=20*(2*i-_)/(_*(e.numlines_s[n-1]+e.numlines_s[n]-1));var o=0|_;o>r&&(o=r),s[n]=o}else s[n]=0}function P(e,a,t,r,n,_){var i,l,f,c=e.internal_flags,h=new float[V.CBANDS],u=s(V.CBANDS),b=new int[V.CBANDS];for(f=l=0;f<c.npart_s;++f){var m=0,p=0,v=c.numlines_s[f];for(i=0;v>i;++i,++l){var d=a[_][l];m+=d,d>p&&(p=d)}t[f]=m,h[f]=p,u[f]=m/v}for(;f<V.CBANDS;++f)h[f]=0,u[f]=0;for(y(c,h,u,b),l=f=0;f<c.npart_s;f++){var g,S,R,M,A,B=c.s3ind_s[f][0],w=c.s3ind_s[f][1];for(g=b[B],S=1,M=c.s3_ss[l]*t[B]*pe[b[B]],++l,++B;w>=B;)g+=b[B],S+=1,R=c.s3_ss[l]*t[B]*pe[b[B]],M=o(M,R,B-f),++l,++B;g=(1+2*g)/(2*S),A=.5*pe[g],M*=A,r[f]=M,c.nb_s2[n][f]=c.nb_s1[n][f],c.nb_s1[n][f]=M,R=h[f],R*=c.minval_s[f],R*=A,r[f]>R&&(r[f]=R),c.masking_lower>1&&(r[f]*=c.masking_lower),r[f]>t[f]&&(r[f]=t[f]),c.masking_lower<1&&(r[f]*=c.masking_lower)}for(;f<V.CBANDS;++f)t[f]=0,r[f]=0}function I(e,a,r,n,_){var i,l=s(V.CBANDS),f=s(V.CBANDS),c=t(V.CBANDS+2);M(e,a,r,l,f),A(e,l,f,c);var h=0;for(i=0;i<e.npart_l;i++){var u,b,m,p,v=e.s3ind[i][0],d=e.s3ind[i][1],g=0,S=0;for(g=c[v],S+=1,b=e.s3_ll[h]*r[v]*pe[c[v]],++h,++v;d>=v;)g+=c[v],S+=1,u=e.s3_ll[h]*r[v]*pe[c[v]],p=o(b,u,v-i),b=p,++h,++v;if(g=(1+2*g)/(2*S),m=.5*pe[g],b*=m,e.blocktype_old[1&_]==V.SHORT_TYPE){var R=ee*e.nb_1[_][i];R>0?n[i]=Math.min(b,R):n[i]=Math.min(b,r[i]*le)}else{var R,B=ae*e.nb_2[_][i],w=ee*e.nb_1[_][i];0>=B&&(B=b),0>=w&&(w=b),R=e.blocktype_old[1&_]==V.NORM_TYPE?Math.min(w,B):w,n[i]=Math.min(b,R)}e.nb_2[_][i]=e.nb_1[_][i],e.nb_1[_][i]=b,u=l[i],u*=e.minval_l[i],u*=m,n[i]>u&&(n[i]=u),e.masking_lower>1&&(n[i]*=e.masking_lower),n[i]>r[i]&&(n[i]=r[i]),e.masking_lower<1&&(n[i]*=e.masking_lower)}for(;i<V.CBANDS;++i)r[i]=0,n[i]=0}function H(e,a){var t=e.internal_flags;e.short_blocks!=l.short_block_coupled||0!=a[0]&&0!=a[1]||(a[0]=a[1]=0);for(var s=0;s<t.channels_out;s++)e.short_blocks==l.short_block_dispensed&&(a[s]=1),e.short_blocks==l.short_block_forced&&(a[s]=0)}function O(e,a,t){for(var s=e.internal_flags,r=0;r<s.channels_out;r++){var n=V.NORM_TYPE;0!=a[r]?s.blocktype_old[r]==V.SHORT_TYPE&&(n=V.STOP_TYPE):(n=V.SHORT_TYPE,s.blocktype_old[r]==V.NORM_TYPE&&(s.blocktype_old[r]=V.START_TYPE),s.blocktype_old[r]==V.STOP_TYPE&&(s.blocktype_old[r]=V.SHORT_TYPE)),t[r]=s.blocktype_old[r],s.blocktype_old[r]=n}}function L(e,a,t,s,r,n,_){for(var i,o,l=2*n,f=n>0?Math.pow(10,r):1,c=0;_>c;++c){var h=e[2][c],u=e[3][c],b=a[0][c],m=a[1][c],p=a[2][c],v=a[3][c];if(1.58*m>=b&&1.58*b>=m){var d=t[c]*u,g=t[c]*h;o=Math.max(p,Math.min(v,d)),i=Math.max(v,Math.min(p,g))}else o=p,i=v;if(n>0){var S,R,M=s[c]*f;if(S=Math.min(Math.max(b,M),Math.max(m,M)),p=Math.max(o,M),v=Math.max(i,M),R=p+v,R>0&&R>S*l){var A=S*l/R;p*=A,v*=A}o=Math.min(p,o),i=Math.min(v,i)}o>h&&(o=h),i>u&&(i=u),a[2][c]=o,a[3][c]=i}}function N(e,a){var t,s=e;return t=s>=0?27*-s:s*a,-72>=t?0:Math.exp(t*he)}function D(e){var a,t,s=0,r=0,n=0;for(n=0;N(n,e)>1e-20;n-=1);for(a=n,t=0;Math.abs(t-a)>1e-12;)n=(t+a)/2,N(n,e)>0?t=n:a=n;s=a;var a,t,n=0;for(n=0;N(n,e)>1e-20;n+=1);for(a=0,t=n;Math.abs(t-a)>1e-12;)n=(t+a)/2,N(n,e)>0?a=n:t=n;r=t;var _,i=0,o=1e3;for(_=0;o>=_;++_){var n=s+_*(r-s)/o,l=N(n,e);i+=l}var f=(o+1)/(i*(r-s));return f}function X(e){var a,t,s,r;return a=e,a*=a>=0?3:1.5,a>=.5&&2.5>=a?(r=a-.5,t=8*(r*r-2*r)):t=0,a+=.474,s=15.811389+7.5*a-17.5*Math.sqrt(1+a*a),-60>=s?0:(a=Math.exp((t+s)*he),a/=.6609193)}function q(e){return 0>e&&(e=0),e=.001*e,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function C(e,a,r,n,_,i,o,l,f,c,h,u){var b,m=s(V.CBANDS+1),p=l/(u>15?1152:384),v=t(V.HBLKSIZE);l/=f;var d=0,g=0;for(b=0;b<V.CBANDS;b++){var S,R;for(S=q(l*d),m[b]=l*d,R=d;q(l*R)-S<re&&f/2>=R;R++);for(e[b]=R-d,g=b+1;R>d;)v[d++]=b;if(d>f/2){d=f/2,++b;break}}m[b]=l*d;for(var M=0;u>M;M++){var A,B,w,T,E;w=c[M],T=c[M+1],A=0|Math.floor(.5+h*(w-.5)),0>A&&(A=0),B=0|Math.floor(.5+h*(T-.5)),B>f/2&&(B=f/2),r[M]=(v[A]+v[B])/2,a[M]=v[B];var k=p*T;o[M]=(k-m[a[M]])/(m[a[M]+1]-m[a[M]]),o[M]<0?o[M]=0:o[M]>1&&(o[M]=1),E=q(l*c[M]*h),E=Math.min(E,15.5)/15.5,i[M]=Math.pow(10,1.25*(1-Math.cos(Math.PI*E))-2.5)}d=0;for(var x=0;g>x;x++){var S,y,P=e[x];S=q(l*d),y=q(l*(d+P-1)),n[x]=.5*(S+y),S=q(l*(d-.5)),y=q(l*(d+P-.5)),_[x]=y-S,d+=P}return g}function F(e,a,t,r,_,i){var o,l=n([V.CBANDS,V.CBANDS]),f=0;if(i)for(var c=0;a>c;c++)for(o=0;a>o;o++){var h=X(t[c]-t[o])*r[o];l[c][o]=h*_[c]}else for(o=0;a>o;o++)for(var u=15+Math.min(21/t[o],12),b=D(u),c=0;a>c;c++){var h=b*N(t[c]-t[o],u)*r[o];l[c][o]=h*_[c]}for(var c=0;a>c;c++){for(o=0;a>o&&!(l[c][o]>0);o++);for(e[c][0]=o,o=a-1;o>0&&!(l[c][o]>0);o--);e[c][1]=o,f+=e[c][1]-e[c][0]+1}for(var m=s(f),p=0,c=0;a>c;c++)for(o=e[c][0];o<=e[c][1];o++)m[p++]=l[c][o];return m}function j(e){var a=q(e);return a=Math.min(a,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*a))-2.5)}function G(e,a){-.3>e&&(e=3410),e/=1e3,e=Math.max(.1,e);var t=3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*a)*Math.pow(e,4);return t}var z,K,Z,Q=new Y,W=2.302585092994046,ee=2,ae=16,te=2,se=16,re=.34,ne=1/217621504/(V.BLKSIZE/2),_e=.01,ie=.8,oe=.6,le=.3,fe=3.5,ce=21,he=.2302585093,ue=8,be=23,me=15,pe=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],ve=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],de=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],ge=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],Se=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],Re=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],Me=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],Ae=[-1.730326e-17,-0.01703172,-1.349528e-17,.0418072,-6.73278e-17,-0.0876324,-3.0835e-17,.1863476,-1.104424e-16,-0.627638];this.L3psycho_anal_ns=function(e,a,_,o,l,B,w,T,E,k){var x,y,P,I,H,O,L,N,D,X=e.internal_flags,Y=n([2,V.BLKSIZE]),q=n([2,3,V.BLKSIZE_s]),C=s(V.CBANDS+1),F=s(V.CBANDS+1),j=s(V.CBANDS+2),G=t(2),z=t(2),K=n([2,576]),Z=t(V.CBANDS+2),Q=t(V.CBANDS+2);for(U.fill(Q,0),x=X.channels_out,e.mode==c.JOINT_STEREO&&(x=4),D=e.VBR==f.vbr_off?0==X.ResvMax?0:X.ResvSize/X.ResvMax*.5:e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh||e.VBR==f.vbr_mt?.6:1,y=0;y<X.channels_out;y++){var W=a[y],J=_+576-350-ce+192;for(I=0;576>I;I++){var $,te;for($=W[J+I+10],te=0,H=0;(ce-1)/2-1>H;H+=2)$+=Ae[H]*(W[J+I+H]+W[J+I+ce-H]),te+=Ae[H+1]*(W[J+I+H+1]+W[J+I+ce-H-1]);K[y][I]=$+te}l[o][y].en.assign(X.en[y]),l[o][y].thm.assign(X.thm[y]),x>2&&(B[o][y].en.assign(X.en[y+2]),B[o][y].thm.assign(X.thm[y+2]))}for(y=0;x>y;y++){var se,re,ne,_e=s(12),fe=[0,0,0,0],he=s(12),ue=1,be=s(V.CBANDS),me=s(V.CBANDS),ve=[0,0,0,0],de=s(V.HBLKSIZE),ge=n([3,V.HBLKSIZE_s]);for(I=0;3>I;I++)_e[I]=X.nsPsy.last_en_subshort[y][I+6],he[I]=_e[I]/X.nsPsy.last_en_subshort[y][I+4],fe[0]+=_e[I];if(2==y)for(I=0;576>I;I++){var Se,Re;Se=K[0][I],Re=K[1][I],K[0][I]=Se+Re,K[1][I]=Se-Re}var Me=K[1&y],Be=0;for(I=0;9>I;I++){for(var we=Be+64,Te=1;we>Be;Be++)Te<Math.abs(Me[Be])&&(Te=Math.abs(Me[Be]));X.nsPsy.last_en_subshort[y][I]=_e[I+3]=Te,fe[1+I/3]+=Te,Te>_e[I+3-2]?Te/=_e[I+3-2]:Te=_e[I+3-2]>10*Te?_e[I+3-2]/(10*Te):0,he[I+3]=Te}if(e.analysis){var Ee=he[0];for(I=1;12>I;I++)Ee<he[I]&&(Ee=he[I]);X.pinfo.ers[o][y]=X.pinfo.ers_save[y],X.pinfo.ers_save[y]=Ee}for(ne=3==y?X.nsPsy.attackthre_s:X.nsPsy.attackthre,I=0;12>I;I++)0==ve[I/3]&&he[I]>ne&&(ve[I/3]=I%3+1);for(I=1;4>I;I++){var ke;ke=fe[I-1]>fe[I]?fe[I-1]/fe[I]:fe[I]/fe[I-1],1.7>ke&&(ve[I]=0,1==I&&(ve[0]=0))}for(0!=ve[0]&&0!=X.nsPsy.lastAttacks[y]&&(ve[0]=0),(3==X.nsPsy.lastAttacks[y]||ve[0]+ve[1]+ve[2]+ve[3]!=0)&&(ue=0,0!=ve[1]&&0!=ve[0]&&(ve[1]=0),0!=ve[2]&&0!=ve[1]&&(ve[2]=0),0!=ve[3]&&0!=ve[2]&&(ve[3]=0)),2>y?z[y]=ue:0==ue&&(z[0]=z[1]=0),E[y]=X.tot_ener[y],re=q,se=Y,r(e,de,ge,se,1&y,re,1&y,o,y,a,_),M(X,de,C,be,me),A(X,be,me,Z),N=0;3>N;N++){var xe,ye;for(v(e,ge,F,j,y,N),m(X,F,j,y,N),L=0;L<V.SBMAX_s;L++){if(ye=X.thm[y].s[L][N],ye*=ie,ve[N]>=2||1==ve[N+1]){var Pe=0!=N?N-1:2,Te=g(X.thm[y].s[L][Pe],ye,oe*D);ye=Math.min(ye,Te)}if(1==ve[N]){var Pe=0!=N?N-1:2,Te=g(X.thm[y].s[L][Pe],ye,le*D);ye=Math.min(ye,Te)}else if(0!=N&&3==ve[N-1]||0==N&&3==X.nsPsy.lastAttacks[y]){var Pe=2!=N?N+1:0,Te=g(X.thm[y].s[L][Pe],ye,le*D);ye=Math.min(ye,Te)}xe=_e[3*N+3]+_e[3*N+4]+_e[3*N+5],6*_e[3*N+5]<xe&&(ye*=.5,6*_e[3*N+4]<xe&&(ye*=.5)),X.thm[y].s[L][N]=ye}}for(X.nsPsy.lastAttacks[y]=ve[2],O=0,P=0;P<X.npart_l;P++){for(var Ie=X.s3ind[P][0],He=C[Ie]*pe[Z[Ie]],Ve=X.s3_ll[O++]*He;++Ie<=X.s3ind[P][1];)He=C[Ie]*pe[Z[Ie]],Ve=i(Ve,X.s3_ll[O++]*He,Ie,Ie-P,X,0);Ve*=.158489319246111,X.blocktype_old[1&y]==V.SHORT_TYPE?j[P]=Ve:j[P]=g(Math.min(Ve,Math.min(ee*X.nb_1[y][P],ae*X.nb_2[y][P])),Ve,D),X.nb_2[y][P]=X.nb_1[y][P],X.nb_1[y][P]=Ve}for(;P<=V.CBANDS;++P)C[P]=0,j[P]=0;p(X,C,j,y)}if((e.mode==c.STEREO||e.mode==c.JOINT_STEREO)&&e.interChRatio>0&&h(e,e.interChRatio),e.mode==c.JOINT_STEREO){var Oe;u(X),Oe=e.msfix,Math.abs(Oe)>0&&b(X,Oe,e.ATHlower*X.ATH.adjust)}for(d(e,z,k,G),y=0;x>y;y++){var Le,Ne,De,Xe=0;y>1?(Le=T,Xe=-2,Ne=V.NORM_TYPE,(k[0]==V.SHORT_TYPE||k[1]==V.SHORT_TYPE)&&(Ne=V.SHORT_TYPE),De=B[o][y-2]):(Le=w,Xe=0,Ne=k[y],De=l[o][y]),Ne==V.SHORT_TYPE?Le[Xe+y]=S(De,X.masking_lower):Le[Xe+y]=R(De,X.masking_lower),e.analysis&&(X.pinfo.pe[o][y]=Le[Xe+y])}return 0};var Be=[-1.730326e-17,-0.01703172,-1.349528e-17,.0418072,-6.73278e-17,-0.0876324,-3.0835e-17,.1863476,-1.104424e-16,-0.627638];this.L3psycho_anal_vbr=function(e,a,r,_,i,o,l,f,h,u){var b,v,d=e.internal_flags,M=s(V.HBLKSIZE),A=n([3,V.HBLKSIZE_s]),y=n([2,V.BLKSIZE]),N=n([2,3,V.BLKSIZE_s]),D=n([4,V.CBANDS]),X=n([4,V.CBANDS]),Y=n([4,3]),q=.6,C=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],F=t(2),j=e.mode==c.JOINT_STEREO?4:d.channels_out;E(e,a,r,_,i,o,h,Y,C,F),H(e,F);for(var G=0;j>G;G++){var z=1&G;b=y,B(e,a,r,G,_,M,b,z),T(e,_,G,M),0!=F[z]?I(d,M,D[G],X[G],G):x(d,G)}F[0]+F[1]==2&&e.mode==c.JOINT_STEREO&&L(D,X,d.mld_cb_l,d.ATH.cb_l,e.ATHlower*d.ATH.adjust,e.msfix,d.npart_l);for(var G=0;j>G;G++){var z=1&G;0!=F[z]&&p(d,D[G],X[G],G)}for(var K=0;3>K;K++){for(var G=0;j>G;++G){var z=1&G;0!=F[z]?k(d,G,K):(v=N,w(e,a,r,G,K,A,v,z),P(e,A,D[G],X[G],G,K))}F[0]+F[1]==0&&e.mode==c.JOINT_STEREO&&L(D,X,d.mld_cb_s,d.ATH.cb_s,e.ATHlower*d.ATH.adjust,e.msfix,d.npart_s);for(var G=0;j>G;++G){var z=1&G;0==F[z]&&m(d,D[G],X[G],G,K)}}for(var G=0;j>G;G++){var z=1&G;if(0==F[z])for(var Z=0;Z<V.SBMAX_s;Z++){for(var Q=s(3),K=0;3>K;K++){var U=d.thm[G].s[Z][K];if(U*=ie,C[G][K]>=2||1==C[G][K+1]){var W=0!=K?K-1:2,J=g(d.thm[G].s[Z][W],U,oe*q);U=Math.min(U,J)}else if(1==C[G][K]){var W=0!=K?K-1:2,J=g(d.thm[G].s[Z][W],U,le*q);U=Math.min(U,J)}else if(0!=K&&3==C[G][K-1]||0==K&&3==d.nsPsy.lastAttacks[G]){var W=2!=K?K+1:0,J=g(d.thm[G].s[Z][W],U,le*q);U=Math.min(U,J)}U*=Y[G][K],Q[K]=U}for(var K=0;3>K;K++)d.thm[G].s[Z][K]=Q[K]}}for(var G=0;j>G;G++)d.nsPsy.lastAttacks[G]=C[G][2];O(e,F,u);for(var G=0;j>G;G++){var $,ee,ae,te;G>1?($=f,ee=-2,ae=V.NORM_TYPE,(u[0]==V.SHORT_TYPE||u[1]==V.SHORT_TYPE)&&(ae=V.SHORT_TYPE),te=o[_][G-2]):($=l,ee=0,ae=u[G],te=i[_][G]),ae==V.SHORT_TYPE?$[ee+G]=S(te,d.masking_lower):$[ee+G]=R(te,d.masking_lower),e.analysis&&(d.pinfo.pe[_][G]=$[ee+G])}return 0},this.psymodel_init=function(e){var a,t=e.internal_flags,r=!0,n=13,i=24,o=0,l=0,c=-8.25,h=-4.5,u=s(V.CBANDS),b=s(V.CBANDS),m=s(V.CBANDS),p=e.out_samplerate;switch(e.experimentalZ){default:case 0:r=!0;break;case 1:r=e.VBR==f.vbr_mtrh||e.VBR==f.vbr_mt?!1:!0;break;case 2:r=!1;break;case 3:n=8,o=-1.75,l=-.0125,c=-8.25,h=-2.25}for(t.ms_ener_ratio_old=.25,t.blocktype_old[0]=t.blocktype_old[1]=V.NORM_TYPE,a=0;4>a;++a){for(var v=0;v<V.CBANDS;++v)t.nb_1[a][v]=1e20,t.nb_2[a][v]=1e20,t.nb_s1[a][v]=t.nb_s2[a][v]=1;for(var d=0;d<V.SBMAX_l;d++)t.en[a].l[d]=1e20,t.thm[a].l[d]=1e20;for(var v=0;3>v;++v){for(var d=0;d<V.SBMAX_s;d++)t.en[a].s[d][v]=1e20,t.thm[a].s[d][v]=1e20;t.nsPsy.lastAttacks[a]=0}for(var v=0;9>v;v++)t.nsPsy.last_en_subshort[a][v]=10}for(t.loudness_sq_save[0]=t.loudness_sq_save[1]=0,t.npart_l=C(t.numlines_l,t.bo_l,t.bm_l,u,b,t.mld_l,t.PSY.bo_l_weight,p,V.BLKSIZE,t.scalefac_band.l,V.BLKSIZE/1152,V.SBMAX_l),a=0;a<t.npart_l;a++){var g=o;u[a]>=n&&(g=l*(u[a]-n)/(i-n)+o*(i-u[a])/(i-n)),m[a]=Math.pow(10,g/10),t.numlines_l[a]>0?t.rnumlines_l[a]=1/t.numlines_l[a]:t.rnumlines_l[a]=0}t.s3_ll=F(t.s3ind,t.npart_l,u,b,m,r);var v=0;for(a=0;a<t.npart_l;a++){var S;S=$.MAX_VALUE;for(var R=0;R<t.numlines_l[a];R++,v++){var M,A=p*v/(1e3*V.BLKSIZE);M=this.ATHformula(1e3*A,e)-20,M=Math.pow(10,.1*M),M*=t.numlines_l[a],S>M&&(S=M)}t.ATH.cb_l[a]=S,S=-20+20*u[a]/10,S>6&&(S=100),-15>S&&(S=-15),S-=8,t.minval_l[a]=Math.pow(10,S/10)*t.numlines_l[a]}for(t.npart_s=C(t.numlines_s,t.bo_s,t.bm_s,u,b,t.mld_s,t.PSY.bo_s_weight,p,V.BLKSIZE_s,t.scalefac_band.s,V.BLKSIZE_s/384,V.SBMAX_s),v=0,a=0;a<t.npart_s;a++){var S,g=c;u[a]>=n&&(g=h*(u[a]-n)/(i-n)+c*(i-u[a])/(i-n)),m[a]=Math.pow(10,g/10),S=$.MAX_VALUE;for(var R=0;R<t.numlines_s[a];R++,v++){var M,A=p*v/(1e3*V.BLKSIZE_s);M=this.ATHformula(1e3*A,e)-20,M=Math.pow(10,.1*M),M*=t.numlines_s[a],S>M&&(S=M)}t.ATH.cb_s[a]=S,S=-7+7*u[a]/12,u[a]>12&&(S*=1+3.1*Math.log(1+S)),u[a]<12&&(S*=1+2.3*Math.log(1-S)),-15>S&&(S=-15),S-=8,t.minval_s[a]=Math.pow(10,S/10)*t.numlines_s[a]}t.s3_ss=F(t.s3ind_s,t.npart_s,u,b,m,r),_(),Q.init_fft(t),t.decay=Math.exp(-1*W/(_e*p/192));var B;B=fe,0!=(2&e.exp_nspsytune)&&(B=1),Math.abs(e.msfix)>0&&(B=e.msfix),e.msfix=B;for(var w=0;w<t.npart_l;w++)t.s3ind[w][1]>t.npart_l-1&&(t.s3ind[w][1]=t.npart_l-1);var T=576*t.mode_gr/p;if(t.ATH.decay=Math.pow(10,-1.2*T),t.ATH.adjust=.01,t.ATH.adjustLimit=1,-1!=e.ATHtype){var A,E=e.out_samplerate/V.BLKSIZE,k=0;for(A=0,a=0;a<V.BLKSIZE/2;++a)A+=E,t.ATH.eql_w[a]=1/Math.pow(10,this.ATHformula(A,e)/10),k+=t.ATH.eql_w[a];for(k=1/k,a=V.BLKSIZE/2;--a>=0;)t.ATH.eql_w[a]*=k}for(var w=v=0;w<t.npart_s;++w)for(a=0;a<t.numlines_s[w];++a)++v;for(var w=v=0;w<t.npart_l;++w)for(a=0;a<t.numlines_l[w];++a)++v;for(v=0,a=0;a<t.npart_l;a++){var A=p*(v+t.numlines_l[a]/2)/(1*V.BLKSIZE);t.mld_cb_l[a]=j(A),v+=t.numlines_l[a]}for(;a<V.CBANDS;++a)t.mld_cb_l[a]=1;for(v=0,a=0;a<t.npart_s;a++){var A=p*(v+t.numlines_s[a]/2)/(1*V.BLKSIZE_s);t.mld_cb_s[a]=j(A),v+=t.numlines_s[a]}for(;a<V.CBANDS;++a)t.mld_cb_s[a]=1;return 0},this.ATHformula=function(e,a){var t;switch(a.ATHtype){case 0:t=G(e,9);break;case 1:t=G(e,-1);break;case 2:t=G(e,0);break;case 3:t=G(e,1)+6;break;case 4:t=G(e,a.ATHcurve);break;default:t=G(e,0)}return t}}function C(){function e(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=s(V.SBMAX_l),this.bo_s_weight=s(V.SBMAX_s)}function a(){this.lowerlimit=0}function t(e,a){this.lowpass=a}function r(e){var a;return e.class_id=$,a=e.internal_flags=new X,e.mode=c.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,a.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=f.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,a.VBR_min_bitrate=1,a.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,a.resample_ratio=1,a.OldValue[0]=180,a.OldValue[1]=180,a.CurrentStep[0]=4,a.CurrentStep[1]=4,a.masking_lower=1,a.nsPsy.attackthre=-1,a.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,a.mf_samples_to_encode=V.ENCDELAY+V.POSTDELAY,e.encoder_padding=0,a.mf_size=V.ENCDELAY-V.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,a.decode_on_the_fly=!1,a.findReplayGain=!1,a.findPeakSample=!1,a.RadioGain=0,a.AudiophileGain=0,a.noclipGainChange=0,a.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}function n(e){return e>1?0:0>=e?1:Math.cos(Math.PI/2*e)}function o(e,a){var t=44100;return a>=48e3?t=48e3:a>=44100?t=44100:a>=32e3?t=32e3:a>=24e3?t=24e3:a>=22050?t=22050:a>=16e3?t=16e3:a>=12e3?t=12e3:a>=11025?t=11025:a>=8e3&&(t=8e3),-1==e?t:(15960>=e&&(t=44100),15250>=e&&(t=32e3),11220>=e&&(t=24e3),9970>=e&&(t=22050),7230>=e&&(t=16e3),5420>=e&&(t=12e3),4510>=e&&(t=11025),3970>=e&&(t=8e3),t>a?a>44100?48e3:a>32e3?44100:a>24e3?32e3:a>22050?24e3:a>16e3?22050:a>12e3?16e3:a>11025?12e3:a>8e3?11025:8e3:t)}function h(e,a){switch(e){case 44100:return a.version=1,0;case 48e3:return a.version=1,1;case 32e3:return a.version=1,2;case 22050:return a.version=0,0;case 24e3:return a.version=0,1;case 16e3:return a.version=0,2;case 11025:return a.version=0,0;case 12e3:return a.version=0,1;case 8e3:return a.version=0,2;default:return a.version=0,-1}}function u(e,a,t){16e3>t&&(a=2);for(var s=ee.bitrate_table[a][1],r=2;14>=r;r++)ee.bitrate_table[a][r]>0&&Math.abs(ee.bitrate_table[a][r]-e)<Math.abs(s-e)&&(s=ee.bitrate_table[a][r]);return s}function m(e,a,t){16e3>t&&(a=2);for(var s=0;14>=s;s++)if(ee.bitrate_table[a][s]>0&&ee.bitrate_table[a][s]==e)return s;return-1}function p(e,a){var s=[new t(8,2e3),new t(16,3700),new t(24,3900),new t(32,5500),new t(40,7e3),new t(48,7500),new t(56,1e4),new t(64,11e3),new t(80,13500),new t(96,15100),new t(112,15600),new t(128,17e3),new t(160,17500),new t(192,18600),new t(224,19400),new t(256,19700),new t(320,20500)],r=L.nearestBitrateFullIndex(a);e.lowerlimit=s[r].lowpass}function d(e){var a=e.internal_flags,t=32,s=-1;if(a.lowpass1>0){for(var r=999,_=0;31>=_;_++){var i=_/31;i>=a.lowpass2&&(t=Math.min(t,_)),a.lowpass1<i&&i<a.lowpass2&&(r=Math.min(r,_))}999==r?a.lowpass1=(t-.75)/31:a.lowpass1=(r-.75)/31,a.lowpass2=t/31}if(a.highpass2>0&&a.highpass2<.9*(.75/31)&&(a.highpass1=0,a.highpass2=0,W.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),a.highpass2>0){for(var o=-1,_=0;31>=_;_++){var i=_/31;i<=a.highpass1&&(s=Math.max(s,_)),a.highpass1<i&&i<a.highpass2&&(o=Math.max(o,_))}a.highpass1=s/31,-1==o?a.highpass2=(s+.75)/31:a.highpass2=(o+.75)/31}for(var _=0;32>_;_++){var l,f,i=_/31;l=a.highpass2>a.highpass1?n((a.highpass2-i)/(a.highpass2-a.highpass1+1e-20)):1,f=a.lowpass2>a.lowpass1?n((i-a.lowpass1)/(a.lowpass2-a.lowpass1+1e-20)):1,a.amp_filter[_]=l*f}}function g(e){var a=e.internal_flags;switch(e.quality){default:case 9:a.psymodel=0,a.noise_shaping=0,a.noise_shaping_amp=0,a.noise_shaping_stop=0,a.use_best_huffman=0,a.full_outer_loop=0;break;case 8:e.quality=7;case 7:a.psymodel=1,a.noise_shaping=0,a.noise_shaping_amp=0,a.noise_shaping_stop=0,a.use_best_huffman=0,a.full_outer_loop=0;break;case 6:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),a.noise_shaping_amp=0,a.noise_shaping_stop=0,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=0,a.full_outer_loop=0;break;case 5:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),a.noise_shaping_amp=0,a.noise_shaping_stop=0,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=0,a.full_outer_loop=0;break;case 4:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),a.noise_shaping_amp=0,a.noise_shaping_stop=0,-1==a.subblock_gain&&(a.subblock_gain=1),
a.use_best_huffman=1,a.full_outer_loop=0;break;case 3:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),a.noise_shaping_amp=1,a.noise_shaping_stop=1,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=1,a.full_outer_loop=0;break;case 2:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),0==a.substep_shaping&&(a.substep_shaping=2),a.noise_shaping_amp=1,a.noise_shaping_stop=1,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=1,a.full_outer_loop=0;break;case 1:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),0==a.substep_shaping&&(a.substep_shaping=2),a.noise_shaping_amp=2,a.noise_shaping_stop=1,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=1,a.full_outer_loop=0;break;case 0:a.psymodel=1,0==a.noise_shaping&&(a.noise_shaping=1),0==a.substep_shaping&&(a.substep_shaping=2),a.noise_shaping_amp=2,a.noise_shaping_stop=1,-1==a.subblock_gain&&(a.subblock_gain=1),a.use_best_huffman=1,a.full_outer_loop=0}}function S(e){var a=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&Q.id3tag_write_v2(e),a.bitrate_stereoMode_Hist=_([16,5]),a.bitrate_blockType_Hist=_([16,6]),a.PeakSample=0,e.bWriteVbrTag&&K.InitVbrTag(e)}function R(e,a){(null==e.in_buffer_0||e.in_buffer_nsamples<a)&&(e.in_buffer_0=s(a),e.in_buffer_1=s(a),e.in_buffer_nsamples=a)}function M(e){var a=V.BLKSIZE+e.framesize-V.FFTOFFSET;return a=Math.max(a,512+e.framesize-32)}function E(e,a,t,s,r,n,_){var i,o,l,f,c,h=e.internal_flags,u=0,m=[null,null],p=[null,null];if(h.Class_ID!=$)return-3;if(0==s)return 0;if(c=F.copy_buffer(h,r,n,_,0),0>c)return c;if(n+=c,u+=c,p[0]=a,p[1]=t,v.NEQ(e.scale,0)&&v.NEQ(e.scale,1))for(o=0;s>o;++o)p[0][o]*=e.scale,2==h.channels_out&&(p[1][o]*=e.scale);if(v.NEQ(e.scale_left,0)&&v.NEQ(e.scale_left,1))for(o=0;s>o;++o)p[0][o]*=e.scale_left;if(v.NEQ(e.scale_right,0)&&v.NEQ(e.scale_right,1))for(o=0;s>o;++o)p[1][o]*=e.scale_right;if(2==e.num_channels&&1==h.channels_out)for(o=0;s>o;++o)p[0][o]=.5*(p[0][o]+p[1][o]),p[1][o]=0;f=M(e),m[0]=h.mfbuf[0],m[1]=h.mfbuf[1];for(var d=0;s>0;){var g=[null,null],S=0,R=0;g[0]=p[0],g[1]=p[1];var A=new x;if(O(e,m,g,d,s,A),S=A.n_in,R=A.n_out,h.findReplayGain&&!h.decode_on_the_fly&&Y.AnalyzeSamples(h.rgdata,m[0],h.mf_size,m[1],h.mf_size,R,h.channels_out)==b.GAIN_ANALYSIS_ERROR)return-6;if(s-=S,d+=S,2==h.channels_out,h.mf_size+=R,h.mf_samples_to_encode<1&&(h.mf_samples_to_encode=V.ENCDELAY+V.POSTDELAY),h.mf_samples_to_encode+=R,h.mf_size>=f){var B=_-u;if(0==_&&(B=0),i=k(e,m[0],m[1],r,n,B),0>i)return i;for(n+=i,u+=i,h.mf_size-=e.framesize,h.mf_samples_to_encode-=e.framesize,l=0;l<h.channels_out;l++)for(o=0;o<h.mf_size;o++)m[l][o]=m[l][o+e.framesize]}}return u}function k(e,a,t,s,r,n){var _=L.enc.lame_encode_mp3_frame(e,a,t,s,r,n);return e.frameNum++,_}function x(){this.n_in=0,this.n_out=0}function y(){this.num_used=0}function P(e,a){return 0!=a?P(a,e%a):e}function I(e,a,t){var s=Math.PI*a;e/=t,0>e&&(e=0),e>1&&(e=1);var r=e-.5,n=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(r)<1e-9?s/Math.PI:n*Math.sin(t*s*r)/(Math.PI*t*r)}function H(e,a,t,r,n,_,i,o,l){var f,c,h=e.internal_flags,u=0,b=e.out_samplerate/P(e.out_samplerate,e.in_samplerate);b>X.BPC&&(b=X.BPC);var m=Math.abs(h.resample_ratio-Math.floor(.5+h.resample_ratio))<1e-4?1:0,p=1/h.resample_ratio;p>1&&(p=1);var v=31;0==v%2&&--v,v+=m;var d=v+1;if(0==h.fill_buffer_resample_init){for(h.inbuf_old[0]=s(d),h.inbuf_old[1]=s(d),f=0;2*b>=f;++f)h.blackfilt[f]=s(d);for(h.itime[0]=0,h.itime[1]=0,u=0;2*b>=u;u++){var g=0,S=(u-b)/(2*b);for(f=0;v>=f;f++)g+=h.blackfilt[u][f]=I(f-S,p,v);for(f=0;v>=f;f++)h.blackfilt[u][f]/=g}h.fill_buffer_resample_init=1}var R=h.inbuf_old[l];for(c=0;r>c;c++){var M,A;if(M=c*h.resample_ratio,u=0|Math.floor(M-h.itime[l]),v+u-v/2>=i)break;var S=M-h.itime[l]-(u+.5*(v%2));A=0|Math.floor(2*S*b+b+.5);var B=0;for(f=0;v>=f;++f){var w,T=f+u-v/2;w=0>T?R[d+T]:n[_+T],B+=w*h.blackfilt[A][f]}a[t+c]=B}if(o.num_used=Math.min(i,v+u-v/2),h.itime[l]+=o.num_used-c*h.resample_ratio,o.num_used>=d)for(f=0;d>f;f++)R[f]=n[_+o.num_used+f-d];else{var E=d-o.num_used;for(f=0;E>f;++f)R[f]=R[f+o.num_used];for(u=0;d>f;++f,++u)R[f]=n[_+u]}return c}function O(e,a,t,s,r,n){var _=e.internal_flags;if(_.resample_ratio<.9999||_.resample_ratio>1.0001)for(var i=0;i<_.channels_out;i++){var o=new y;n.n_out=H(e,a[i],_.mf_size,e.framesize,t[i],s,r,o,i),n.n_in=o.num_used}else{n.n_out=Math.min(e.framesize,r),n.n_in=n.n_out;for(var l=0;l<n.n_out;++l)a[0][_.mf_size+l]=t[0][s+l],2==_.channels_out&&(a[1][_.mf_size+l]=t[1][s+l])}}var L=this,N=131072;C.V9=410,C.V8=420,C.V7=430,C.V6=440,C.V5=450,C.V4=460,C.V3=470,C.V2=480,C.V1=490,C.V0=500,C.R3MIX=1e3,C.STANDARD=1001,C.EXTREME=1002,C.INSANE=1003,C.STANDARD_FAST=1004,C.EXTREME_FAST=1005,C.MEDIUM=1006,C.MEDIUM_FAST=1007;var D=16384+N;C.LAME_MAXMP3BUFFER=D;var Y,F,j,G,z,K,Z,Q,U,J=new q;this.enc=new V,this.setModules=function(e,a,t,s,r,n,_,i,o){Y=e,F=a,j=t,G=s,z=r,K=n,Z=_,Q=i,U=o,this.enc.setModules(F,J,G,K)};var $=4294479419;this.lame_init=function(){var e=new A,a=r(e);return 0!=a?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var a=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],t=0,s=0,r=0,n=0;n=a[16],r=16,s=a[16],t=16;for(var _=0;16>_;_++)if(Math.max(e,a[_+1])!=e){n=a[_+1],r=_+1,s=a[_],t=_;break}return n-e>e-s?t:r},this.lame_init_params=function(t){var s=t.internal_flags;if(s.Class_ID=0,null==s.ATH&&(s.ATH=new w),null==s.PSY&&(s.PSY=new e),null==s.rgdata&&(s.rgdata=new B),s.channels_in=t.num_channels,1==s.channels_in&&(t.mode=c.MONO),s.channels_out=t.mode==c.MONO?1:2,s.mode_ext=V.MPG_MD_MS_LR,t.mode==c.MONO&&(t.force_ms=!1),t.VBR==f.vbr_off&&128!=t.VBR_mean_bitrate_kbps&&0==t.brate&&(t.brate=t.VBR_mean_bitrate_kbps),t.VBR==f.vbr_off||t.VBR==f.vbr_mtrh||t.VBR==f.vbr_mt||(t.free_format=!1),t.VBR==f.vbr_off&&0==t.brate&&v.EQ(t.compression_ratio,0)&&(t.compression_ratio=11.025),t.VBR==f.vbr_off&&t.compression_ratio>0&&(0==t.out_samplerate&&(t.out_samplerate=map2MP3Frequency(int(.97*t.in_samplerate))),t.brate=0|16*t.out_samplerate*s.channels_out/(1e3*t.compression_ratio),s.samplerate_index=h(t.out_samplerate,t),t.free_format||(t.brate=u(t.brate,t.version,t.out_samplerate))),0!=t.out_samplerate&&(t.out_samplerate<16e3?(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,64)):t.out_samplerate<32e3?(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,160)):(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,32),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,320))),0==t.lowpassfreq){var r=16e3;switch(t.VBR){case f.vbr_off:var n=new a;p(n,t.brate),r=n.lowerlimit;break;case f.vbr_abr:var n=new a;p(n,t.VBR_mean_bitrate_kbps),r=n.lowerlimit;break;case f.vbr_rh:var _=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=t.VBR_q&&t.VBR_q<=9){var i=_[t.VBR_q],R=_[t.VBR_q+1],M=t.VBR_q_frac;r=linear_int(i,R,M)}else r=19500;break;default:var _=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=t.VBR_q&&t.VBR_q<=9){var i=_[t.VBR_q],R=_[t.VBR_q+1],M=t.VBR_q_frac;r=linear_int(i,R,M)}else r=19500}t.mode!=c.MONO||t.VBR!=f.vbr_off&&t.VBR!=f.vbr_abr||(r*=1.5),t.lowpassfreq=0|r}if(0==t.out_samplerate&&(2*t.lowpassfreq>t.in_samplerate&&(t.lowpassfreq=t.in_samplerate/2),t.out_samplerate=o(0|t.lowpassfreq,t.in_samplerate)),t.lowpassfreq=Math.min(20500,t.lowpassfreq),t.lowpassfreq=Math.min(t.out_samplerate/2,t.lowpassfreq),t.VBR==f.vbr_off&&(t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.brate)),t.VBR==f.vbr_abr&&(t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.VBR_mean_bitrate_kbps)),t.bWriteVbrTag||(t.findReplayGain=!1,t.decode_on_the_fly=!1,s.findPeakSample=!1),s.findReplayGain=t.findReplayGain,s.decode_on_the_fly=t.decode_on_the_fly,s.decode_on_the_fly&&(s.findPeakSample=!0),s.findReplayGain&&Y.InitGainAnalysis(s.rgdata,t.out_samplerate)==b.INIT_GAIN_ANALYSIS_ERROR)return t.internal_flags=null,-6;switch(s.decode_on_the_fly&&!t.decode_only&&(null!=s.hip&&U.hip_decode_exit(s.hip),s.hip=U.hip_decode_init()),s.mode_gr=t.out_samplerate<=24e3?1:2,t.framesize=576*s.mode_gr,t.encoder_delay=V.ENCDELAY,s.resample_ratio=t.in_samplerate/t.out_samplerate,t.VBR){case f.vbr_mt:case f.vbr_rh:case f.vbr_mtrh:var A=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];t.compression_ratio=A[t.VBR_q];break;case f.vbr_abr:t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.VBR_mean_bitrate_kbps);break;default:t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.brate)}if(t.mode==c.NOT_SET&&(t.mode=c.JOINT_STEREO),t.highpassfreq>0?(s.highpass1=2*t.highpassfreq,t.highpasswidth>=0?s.highpass2=2*(t.highpassfreq+t.highpasswidth):s.highpass2=2*t.highpassfreq,s.highpass1/=t.out_samplerate,s.highpass2/=t.out_samplerate):(s.highpass1=0,s.highpass2=0),t.lowpassfreq>0?(s.lowpass2=2*t.lowpassfreq,t.lowpasswidth>=0?(s.lowpass1=2*(t.lowpassfreq-t.lowpasswidth),s.lowpass1<0&&(s.lowpass1=0)):s.lowpass1=2*t.lowpassfreq,s.lowpass1/=t.out_samplerate,s.lowpass2/=t.out_samplerate):(s.lowpass1=0,s.lowpass2=0),d(t),s.samplerate_index=h(t.out_samplerate,t),s.samplerate_index<0)return t.internal_flags=null,-1;if(t.VBR==f.vbr_off){if(t.free_format)s.bitrate_index=0;else if(t.brate=u(t.brate,t.version,t.out_samplerate),s.bitrate_index=m(t.brate,t.version,t.out_samplerate),s.bitrate_index<=0)return t.internal_flags=null,-1}else s.bitrate_index=1;t.analysis&&(t.bWriteVbrTag=!1),null!=s.pinfo&&(t.bWriteVbrTag=!1),F.init_bit_stream_w(s);for(var E=s.samplerate_index+3*t.version+6*(t.out_samplerate<16e3?1:0),k=0;k<V.SBMAX_l+1;k++)s.scalefac_band.l[k]=G.sfBandIndex[E].l[k];for(var k=0;k<V.PSFB21+1;k++){var x=(s.scalefac_band.l[22]-s.scalefac_band.l[21])/V.PSFB21,y=s.scalefac_band.l[21]+k*x;s.scalefac_band.psfb21[k]=y}s.scalefac_band.psfb21[V.PSFB21]=576;for(var k=0;k<V.SBMAX_s+1;k++)s.scalefac_band.s[k]=G.sfBandIndex[E].s[k];for(var k=0;k<V.PSFB12+1;k++){var x=(s.scalefac_band.s[13]-s.scalefac_band.s[12])/V.PSFB12,y=s.scalefac_band.s[12]+k*x;s.scalefac_band.psfb12[k]=y}s.scalefac_band.psfb12[V.PSFB12]=192,1==t.version?s.sideinfo_len=1==s.channels_out?21:36:s.sideinfo_len=1==s.channels_out?13:21,t.error_protection&&(s.sideinfo_len+=2),S(t),s.Class_ID=$;var P;for(P=0;19>P;P++)s.nsPsy.pefirbuf[P]=700*s.mode_gr*s.channels_out;switch(-1==t.ATHtype&&(t.ATHtype=4),t.VBR){case f.vbr_mt:t.VBR=f.vbr_mtrh;case f.vbr_mtrh:null==t.useTemporal&&(t.useTemporal=!1),j.apply_preset(t,500-10*t.VBR_q,0),t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),t.quality<5&&(t.quality=0),t.quality>5&&(t.quality=5),s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,t.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=t.out_samplerate>44e3,s.iteration_loop=new VBRNewIterationLoop(z);break;case f.vbr_rh:j.apply_preset(t,500-10*t.VBR_q,0),s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,t.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=t.out_samplerate>44e3,t.quality>6&&(t.quality=6),t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),s.iteration_loop=new VBROldIterationLoop(z);break;default:var I;s.sfb21_extra=!1,t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),I=t.VBR,I==f.vbr_off&&(t.VBR_mean_bitrate_kbps=t.brate),j.apply_preset(t,t.VBR_mean_bitrate_kbps,0),t.VBR=I,s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,I==f.vbr_off?s.iteration_loop=new T(z):s.iteration_loop=new ABRIterationLoop(z)}if(t.VBR!=f.vbr_off){if(s.VBR_min_bitrate=1,s.VBR_max_bitrate=14,t.out_samplerate<16e3&&(s.VBR_max_bitrate=8),0!=t.VBR_min_bitrate_kbps&&(t.VBR_min_bitrate_kbps=u(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),s.VBR_min_bitrate=m(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),s.VBR_min_bitrate<0))return-1;if(0!=t.VBR_max_bitrate_kbps&&(t.VBR_max_bitrate_kbps=u(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),s.VBR_max_bitrate=m(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),s.VBR_max_bitrate<0))return-1;t.VBR_min_bitrate_kbps=ee.bitrate_table[t.version][s.VBR_min_bitrate],t.VBR_max_bitrate_kbps=ee.bitrate_table[t.version][s.VBR_max_bitrate],t.VBR_mean_bitrate_kbps=Math.min(ee.bitrate_table[t.version][s.VBR_max_bitrate],t.VBR_mean_bitrate_kbps),t.VBR_mean_bitrate_kbps=Math.max(ee.bitrate_table[t.version][s.VBR_min_bitrate],t.VBR_mean_bitrate_kbps)}return t.tune&&(s.PSY.mask_adjust+=t.tune_value_a,s.PSY.mask_adjust_short+=t.tune_value_a),g(t),t.athaa_type<0?s.ATH.useAdjust=3:s.ATH.useAdjust=t.athaa_type,s.ATH.aaSensitivityP=Math.pow(10,t.athaa_sensitivity/-10),null==t.short_blocks&&(t.short_blocks=l.short_block_allowed),t.short_blocks!=l.short_block_allowed||t.mode!=c.JOINT_STEREO&&t.mode!=c.STEREO||(t.short_blocks=l.short_block_coupled),t.quant_comp<0&&(t.quant_comp=1),t.quant_comp_short<0&&(t.quant_comp_short=0),t.msfix<0&&(t.msfix=0),t.exp_nspsytune=1|t.exp_nspsytune,t.internal_flags.nsPsy.attackthre<0&&(t.internal_flags.nsPsy.attackthre=q.NSATTACKTHRE),t.internal_flags.nsPsy.attackthre_s<0&&(t.internal_flags.nsPsy.attackthre_s=q.NSATTACKTHRE_S),t.scale<0&&(t.scale=1),t.ATHtype<0&&(t.ATHtype=4),t.ATHcurve<0&&(t.ATHcurve=4),t.athaa_loudapprox<0&&(t.athaa_loudapprox=2),t.interChRatio<0&&(t.interChRatio=0),null==t.useTemporal&&(t.useTemporal=!0),s.slot_lag=s.frac_SpF=0,t.VBR==f.vbr_off&&(s.slot_lag=s.frac_SpF=72e3*(t.version+1)*t.brate%t.out_samplerate|0),G.iteration_init(t),J.psymodel_init(t),0},this.lame_encode_flush=function(e,a,t,s){var r,n,_,o,l=e.internal_flags,f=i([2,1152]),c=0,h=l.mf_samples_to_encode-V.POSTDELAY,u=M(e);if(l.mf_samples_to_encode<1)return 0;for(r=0,e.in_samplerate!=e.out_samplerate&&(h+=16*e.out_samplerate/e.in_samplerate),_=e.framesize-h%e.framesize,576>_&&(_+=e.framesize),e.encoder_padding=_,o=(h+_)/e.framesize;o>0&&c>=0;){var b=u-l.mf_size,m=e.frameNum;b*=e.in_samplerate,b/=e.out_samplerate,b>1152&&(b=1152),1>b&&(b=1),n=s-r,0==s&&(n=0),c=this.lame_encode_buffer(e,f[0],f[1],b,a,t,n),t+=c,r+=c,o-=m!=e.frameNum?1:0}if(l.mf_samples_to_encode=0,0>c)return c;if(n=s-r,0==s&&(n=0),F.flush_bitstream(e),c=F.copy_buffer(l,a,t,n,1),0>c)return c;if(t+=c,r+=c,n=s-r,0==s&&(n=0),e.write_id3tag_automatic){if(Q.id3tag_write_v1(e),c=F.copy_buffer(l,a,t,n,0),0>c)return c;r+=c}return r},this.lame_encode_buffer=function(e,a,t,s,r,n,_){var i=e.internal_flags,o=[null,null];if(i.Class_ID!=$)return-3;if(0==s)return 0;R(i,s),o[0]=i.in_buffer_0,o[1]=i.in_buffer_1;for(var l=0;s>l;l++)o[0][l]=a[l],i.channels_in>1&&(o[1][l]=t[l]);return E(e,o[0],o[1],s,r,n,_)}}function F(){var e,a;this.setModules=function(t,s){e=t,a=s}}function j(){var e,a,t;this.setModules=function(s,r,n){e=s,a=r,t=n}}function G(){}function z(){var e,a;this.setModules=function(t,s){e=t,a=s}}function K(a,t,s){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),a=1,t=44100,s=128);var r=new C,n=new F,_=new b,i=new v,o=new u,l=new k,f=new P,g=new d,S=new h,R=new z,M=new p,A=new m,B=new j,w=new G;r.setModules(_,i,o,l,f,g,S,R,w),i.setModules(_,w,S,g),R.setModules(i,S),o.setModules(r),f.setModules(i,M,l,A),l.setModules(A,M,r.enc.psy),M.setModules(i),A.setModules(l),g.setModules(r,i,S),n.setModules(B,w),B.setModules(S,R,o);var T=r.lame_init();T.num_channels=a,T.in_samplerate=t,T.brate=s,T.mode=c.STEREO,T.quality=3,T.bWriteVbrTag=!1,T.disable_reservoir=!0,T.write_id3tag_automatic=!1;var E=(r.lame_init_params(T),1152),x=0|1.25*E+7200,y=e(x);this.encodeBuffer=function(t,s){1==a&&(s=t),t.length>E&&(E=t.length,x=0|1.25*E+7200,y=e(x));var n=r.lame_encode_buffer(T,t,s,t.length,y,0,x);return new Int8Array(y.subarray(0,n))},this.flush=function(){var e=r.lame_encode_flush(T,y,0,x);return new Int8Array(y.subarray(0,e))}}function Z(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Q(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}var U={};U.fill=function(e,a,t,s){if(2==arguments.length)for(var r=0;r<e.length;r++)e[r]=arguments[1];else for(var r=a;t>r;r++)e[r]=s};var W={};W.arraycopy=function(e,a,t,s,r){for(var n=a+r;n>a;)t[s++]=e[a++]};var J={};J.SQRT2=1.4142135623730951,J.FAST_LOG10=function(e){return Math.log10(e)},J.FAST_LOG10_X=function(e,a){return Math.log10(e)*a},l.short_block_allowed=new l(0),l.short_block_coupled=new l(1),l.short_block_dispensed=new l(2),l.short_block_forced=new l(3);var $={};$.MAX_VALUE=3.4028235e38,f.vbr_off=new f(0),f.vbr_mt=new f(1),f.vbr_rh=new f(2),f.vbr_abr=new f(3),f.vbr_mtrh=new f(4),f.vbr_default=f.vbr_mtrh;c.STEREO=new c(0),c.JOINT_STEREO=new c(1),c.DUAL_CHANNEL=new c(2),c.MONO=new c(3),c.NOT_SET=new c(4),b.STEPS_per_dB=100,b.MAX_dB=120,b.GAIN_NOT_ENOUGH_SAMPLES=-24601,b.GAIN_ANALYSIS_ERROR=0,b.GAIN_ANALYSIS_OK=1,b.INIT_GAIN_ANALYSIS_ERROR=0,b.INIT_GAIN_ANALYSIS_OK=1,b.YULE_ORDER=10,b.MAX_ORDER=b.YULE_ORDER,b.MAX_SAMP_FREQ=48e3,b.RMS_WINDOW_TIME_NUMERATOR=1,b.RMS_WINDOW_TIME_DENOMINATOR=20,b.MAX_SAMPLES_PER_WINDOW=b.MAX_SAMP_FREQ*b.RMS_WINDOW_TIME_NUMERATOR/b.RMS_WINDOW_TIME_DENOMINATOR+1,v.EQ=function(e,a){return Math.abs(e)>Math.abs(a)?Math.abs(e-a)<=1e-6*Math.abs(e):Math.abs(e-a)<=1e-6*Math.abs(a)},v.NEQ=function(e,a){return!v.EQ(e,a)},d.NUMTOCENTRIES=100,d.MAXFRAMESIZE=2880;var ee={};ee.t1HB=[1,1,1,0],ee.t2HB=[1,2,1,3,1,1,3,2,0],ee.t3HB=[3,2,1,1,1,1,3,2,0],ee.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ee.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ee.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ee.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ee.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ee.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ee.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ee.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ee.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ee.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ee.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ee.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ee.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],ee.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],ee.t1l=[1,4,3,5],ee.t2l=[1,4,7,4,5,7,6,7,8],ee.t3l=[2,3,7,4,4,7,6,7,8],ee.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ee.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ee.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ee.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ee.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ee.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ee.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ee.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ee.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ee.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ee.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ee.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ee.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ee.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],ee.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],ee.ht=[new g(0,0,null,null),new g(2,0,ee.t1HB,ee.t1l),new g(3,0,ee.t2HB,ee.t2l),new g(3,0,ee.t3HB,ee.t3l),new g(0,0,null,null),new g(4,0,ee.t5HB,ee.t5l),new g(4,0,ee.t6HB,ee.t6l),new g(6,0,ee.t7HB,ee.t7l),new g(6,0,ee.t8HB,ee.t8l),new g(6,0,ee.t9HB,ee.t9l),new g(8,0,ee.t10HB,ee.t10l),new g(8,0,ee.t11HB,ee.t11l),new g(8,0,ee.t12HB,ee.t12l),new g(16,0,ee.t13HB,ee.t13l),new g(0,0,null,ee.t16_5l),new g(16,0,ee.t15HB,ee.t15l),new g(1,1,ee.t16HB,ee.t16l),new g(2,3,ee.t16HB,ee.t16l),new g(3,7,ee.t16HB,ee.t16l),new g(4,15,ee.t16HB,ee.t16l),new g(6,63,ee.t16HB,ee.t16l),new g(8,255,ee.t16HB,ee.t16l),new g(10,1023,ee.t16HB,ee.t16l),new g(13,8191,ee.t16HB,ee.t16l),new g(4,15,ee.t24HB,ee.t24l),new g(5,31,ee.t24HB,ee.t24l),new g(6,63,ee.t24HB,ee.t24l),new g(7,127,ee.t24HB,ee.t24l),new g(8,255,ee.t24HB,ee.t24l),new g(9,511,ee.t24HB,ee.t24l),new g(11,2047,ee.t24HB,ee.t24l),new g(13,8191,ee.t24HB,ee.t24l),new g(0,0,ee.t32HB,ee.t32l),new g(0,0,ee.t33HB,ee.t33l)],ee.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ee.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ee.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ee.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ee.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ee.scfsi_band=[0,6,11,16,21],k.Q_MAX=257,k.Q_MAX2=116,k.LARGE_BITS=1e5,k.IXMAX_VAL=8206;var ae={};ae.SFBMAX=3*V.SBMAX_s,V.ENCDELAY=576,V.POSTDELAY=1152,V.MDCTDELAY=48,V.FFTOFFSET=224+V.MDCTDELAY,V.DECDELAY=528,V.SBLIMIT=32,V.CBANDS=64,V.SBPSY_l=21,V.SBPSY_s=12,V.SBMAX_l=22,V.SBMAX_s=13,V.PSFB21=6,V.PSFB12=6,V.BLKSIZE=1024,V.HBLKSIZE=V.BLKSIZE/2+1,V.BLKSIZE_s=256,V.HBLKSIZE_s=V.BLKSIZE_s/2+1,V.NORM_TYPE=0,V.START_TYPE=1,V.SHORT_TYPE=2,V.STOP_TYPE=3,V.MPG_MD_LR_LR=0,V.MPG_MD_LR_I=1,V.MPG_MD_MS_LR=2,V.MPG_MD_MS_I=3,V.fircoef=[-0.1039435,-0.1892065,5*-.0432472,-0.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5],X.MFSIZE=3456+V.ENCDELAY-V.MDCTDELAY,X.MAX_HEADER_BUF=256,X.MAX_BITS_PER_CHANNEL=4095,X.MAX_BITS_PER_GRANULE=7680,X.BPC=320,Z.RIFF=Q("RIFF"),Z.WAVE=Q("WAVE"),Z.fmt_=Q("fmt "),Z.data=Q("data"),Z.readHeader=function(e){var a=new Z,t=e.getUint32(0,!1);if(Z.RIFF==t){e.getUint32(4,!0);if(Z.WAVE==e.getUint32(8,!1)&&Z.fmt_==e.getUint32(12,!1)){var s=e.getUint32(16,!0),r=20;switch(s){case 16:case 18:a.channels=e.getUint16(r+2,!0),a.sampleRate=e.getUint32(r+4,!0);break;default:throw"extended fmt chunk not implemented"}r+=s;for(var n=Z.data,_=0;n!=t&&(t=e.getUint32(r,!1),_=e.getUint32(r+4,!0),n!=t);)r+=_+8;return a.dataLen=_,a.dataOffset=r+8,a}}},ae.SFBMAX=3*V.SBMAX_s,this.Mp3Encoder=K,this.WavHeader=Z}